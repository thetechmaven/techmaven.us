/*! For license information please see chatbot.js.LICENSE.txt */
(()=>{"use strict";var __webpack_modules__={469:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>ChatbotContextProvider,o:()=>useChatbotContext});var _neko_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(296),_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(728),_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(137),_app_helpers__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(678);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var _excluded=["children"];function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof _?t:_,i=Object.create(o.prototype),s=new T(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",h="executing",m="completed",y={};function _(){}function b(){}function v(){}var g={};u(g,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(O([])));x&&x!==r&&n.call(x,i)&&(g=x);var C=v.prototype=_.prototype=Object.create(g);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(a,o,i,s){var c=p(e[a],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var o;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function E(t,r,n){var a=d;return function(o,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var c=I(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=h;var u=p(t,r,n);if("normal"===u.type){if(a=n.done?m:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=m,n.method="throw",n.arg=u.arg)}}}function I(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,I(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var o=p(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,y;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(_typeof(t)+" is not iterable")}return b.prototype=v,a(C,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:b,configurable:!0}),b.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},S(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new R(l(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(C),u(C,c,"Generator"),u(C,i,(function(){return this})),u(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return s.type="throw",s.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;A(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function asyncGeneratorStep(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){asyncGeneratorStep(o,n,a,i,s,"next",e)}function s(e){asyncGeneratorStep(o,n,a,i,s,"throw",e)}i(void 0)}))}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,a=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}var _wp$element=wp.element,useContext=_wp$element.useContext,createContext=_wp$element.createContext,useState=_wp$element.useState,useMemo=_wp$element.useMemo,useEffect=_wp$element.useEffect,useCallback=_wp$element.useCallback,useRef=_wp$element.useRef,rawAiName="AI: ",rawUserName="User: ",ChatbotContext=createContext(),useChatbotContext=function(){var e=useContext(ChatbotContext);if(!e)throw new Error("useChatbotContext must be used within a ChatbotContextProvider");return e},ChatbotContextProvider=function ChatbotContextProvider(_ref){var _system$typewriter,_system$speech_recogn,_system$speech_synthe,_params$startSentence,_params$startSentence2,children=_ref.children,rest=_objectWithoutProperties(_ref,_excluded),params=rest.params,system=rest.system,theme=rest.theme,atts=rest.atts,_useChrono=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.dh)(),timeElapsed=_useChrono.timeElapsed,startChrono=_useChrono.startChrono,stopChrono=_useChrono.stopChrono,shortcodeStyles=useMemo((function(){return(null==theme?void 0:theme.settings)||{}}),[theme]),_useState=useState(system.restNonce),_useState2=_slicedToArray(_useState,2),restNonce=_useState2[0],setRestNonce=_useState2[1],_useState3=useState([]),_useState4=_slicedToArray(_useState3,2),messages=_useState4[0],setMessages=_useState4[1],_useState5=useState([]),_useState6=_slicedToArray(_useState5,2),shortcuts=_useState6[0],setShortcuts=_useState6[1],_useState7=useState([]),_useState8=_slicedToArray(_useState7,2),blocks=_useState8[0],setBlocks=_useState8[1],_useState9=useState(!1),_useState10=_slicedToArray(_useState9,2),locked=_useState10[0],setLocked=_useState10[1],_useState11=useState((0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)()),_useState12=_slicedToArray(_useState11,2),chatId=_useState12[0],setChatId=_useState12[1],_useState13=useState(""),_useState14=_slicedToArray(_useState13,2),inputText=_useState14[0],setInputText=_useState14[1],_useState15=useState(!1),_useState16=_slicedToArray(_useState15,2),chatbotTriggered=_useState16[0],setChatbotTriggered=_useState16[1],_useState17=useState(!1),_useState18=_slicedToArray(_useState17,2),showIconMessage=_useState18[0],setShowIconMessage=_useState18[1],_useState19=useState({localFile:null,uploadedId:null,uploadedUrl:null,uploadProgress:null}),_useState20=_slicedToArray(_useState19,2),uploadedFile=_useState20[0],setUploadedFile=_useState20[1],_useState21=useState(!0),_useState22=_slicedToArray(_useState21,2),windowed=_useState22[0],setWindowed=_useState22[1],_useState23=useState(!1),_useState24=_slicedToArray(_useState23,2),open=_useState24[0],setOpen=_useState24[1],_useState25=useState(null),_useState26=_slicedToArray(_useState25,2),error=_useState26[0],setError=_useState26[1],_useState27=useState(!1),_useState28=_slicedToArray(_useState27,2),busy=_useState28[0],setBusy=_useState28[1],_useState29=useState(!1),_useState30=_slicedToArray(_useState29,2),busyNonce=_useState30[0],setBusyNonce=_useState30[1],_useState31=useState(),_useState32=_slicedToArray(_useState31,2),serverReply=_useState32[0],setServerReply=_useState32[1],chatbotInputRef=useRef(),conversationRef=useRef(),hasFocusRef=useRef(!1),_useSpeechRecognition=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.Vw)((function(e){setInputText(e)})),isListening=_useSpeechRecognition.isListening,setIsListening=_useSpeechRecognition.setIsListening,speechRecognitionAvailable=_useSpeechRecognition.speechRecognitionAvailable,stream=system.stream||!1,internalId=useMemo((function(){return(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)()}),[]),botId=system.botId,customId=system.customId,userData=system.userData,sessionId=system.sessionId,contextId=system.contextId,pluginUrl=system.pluginUrl,restUrl=system.restUrl,debugMode=system.debugMode,virtualKeyboardFix=system.virtual_keyboard_fix,typewriter=null!==(_system$typewriter=null==system?void 0:system.typewriter)&&void 0!==_system$typewriter&&_system$typewriter,speechRecognition=null!==(_system$speech_recogn=null==system?void 0:system.speech_recognition)&&void 0!==_system$speech_recogn&&_system$speech_recogn,speechSynthesis=null!==(_system$speech_synthe=null==system?void 0:system.speech_synthesis)&&void 0!==_system$speech_synthe&&_system$speech_synthe,startSentence=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.Mc)(null!==(_params$startSentence=null===(_params$startSentence2=params.startSentence)||void 0===_params$startSentence2?void 0:_params$startSentence2.trim())&&void 0!==_params$startSentence?_params$startSentence:"",userData),initialActions=system.actions||[],initialShortcuts=system.shortcuts||[],initialBlocks=system.blocks||[],isMobile=document.innerWidth<=768,processedParams=(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__._$)(params,userData),aiName=processedParams.aiName,userName=processedParams.userName,guestName=processedParams.guestName,aiAvatar=processedParams.aiAvatar,userAvatar=processedParams.userAvatar,guestAvatar=processedParams.guestAvatar,textSend=processedParams.textSend,textClear=processedParams.textClear,textInputMaxLength=processedParams.textInputMaxLength,textInputPlaceholder=processedParams.textInputPlaceholder,textCompliance=processedParams.textCompliance,isWindow=processedParams.window,copyButton=processedParams.copyButton,headerSubtitle=processedParams.headerSubtitle,fullscreen=processedParams.fullscreen,localMemoryParam=processedParams.localMemory,icon=processedParams.icon,iconText=processedParams.iconText,iconTextDelay=processedParams.iconTextDelay,iconAlt=processedParams.iconAlt,iconPosition=processedParams.iconPosition,iconBubble=processedParams.iconBubble,imageUpload=processedParams.imageUpload,fileUpload=processedParams.fileUpload,fileSearch=processedParams.fileSearch,isRealtime="realtime"===processedParams.mode,localMemory=localMemoryParam&&(!!customId||!!botId),localStorageKey=localMemory?"mwai-chat-".concat(customId||botId):null,_useMemo=useMemo((function(){var e=function(e){return e?(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Ve)(e)||(0,_app_chatbot_helpers__WEBPACK_IMPORTED_MODULE_0__.mv)(e)?e:"".concat(pluginUrl,"/images/").concat(e):null},t=icon?e(icon):"".concat(pluginUrl,"/images/chat-traditional-1.svg"),r=e(processedParams.aiAvatarUrl),n=e(processedParams.userAvatarUrl),a=e(processedParams.guestAvatarUrl);return{cssVariables:Object.keys(shortcodeStyles).reduce((function(e,t){return e["--mwai-".concat(t)]=shortcodeStyles[t],e}),{}),iconUrl:t,aiAvatarUrl:r,userAvatarUrl:n,guestAvatarUrl:a}}),[icon,pluginUrl,shortcodeStyles,processedParams]),cssVariables=_useMemo.cssVariables,iconUrl=_useMemo.iconUrl,aiAvatarUrl=_useMemo.aiAvatarUrl,userAvatarUrl=_useMemo.userAvatarUrl,guestAvatarUrl=_useMemo.guestAvatarUrl,_useState33=useState(!1),_useState34=_slicedToArray(_useState33,2),draggingType=_useState34[0],setDraggingType=_useState34[1],_useState35=useState(!1),_useState36=_slicedToArray(_useState35,2),isBlocked=_useState36[0],setIsBlocked=_useState36[1],uploadIconPosition=useMemo((function(){return"timeless"===(null==theme?void 0:theme.themeId)?"mwai-tools":"mwai-input"}),[null==theme?void 0:theme.themeId]),submitButtonConf=useMemo((function(){return{text:textSend,textSend,textClear,imageSend:"timeless"===(null==theme?void 0:theme.themeId)?pluginUrl+"/images/action-submit-blue.svg":null,imageClear:"timeless"===(null==theme?void 0:theme.themeId)?pluginUrl+"/images/action-clear-blue.svg":null}}),[pluginUrl,textClear,textSend,null==theme?void 0:theme.themeId]),resetMessages=function(){if(resetUploadedFile(),startSentence){var e=[{id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"assistant",content:startSentence,who:rawAiName,timestamp:(new Date).getTime()}];setMessages(e)}else setMessages([])},refreshRestNonce=useCallback(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,a=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]&&a[0],e.prev=1,t||!restNonce){e.next=4;break}return e.abrupt("return",restNonce);case 4:return setBusyNonce(!0),e.next=7,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)("".concat(restUrl,"/mwai/v1/start_session"));case 7:return r=e.sent,e.next=10,r.json();case 10:return n=e.sent,setRestNonce(n.restNonce),e.abrupt("return",n.restNonce);case 15:e.prev=15,e.t0=e.catch(1),console.error("Error while fetching the restNonce.",e.t0);case 18:return e.prev=18,setBusyNonce(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[1,15,18,21]])}))),[restNonce,setRestNonce,restUrl]);useEffect((function(){initialActions.length>0&&handleActions(initialActions),initialShortcuts.length>0&&handleShortcuts(initialShortcuts),initialBlocks.length>0&&handleBlocks(initialBlocks)}),[]),useEffect((function(){chatbotTriggered&&!restNonce&&refreshRestNonce()}),[chatbotTriggered]),useEffect((function(){inputText.length>0&&!chatbotTriggered&&setChatbotTriggered(!0)}),[chatbotTriggered,inputText]),useEffect((function(){resetMessages()}),[startSentence]),useEffect((function(){if(customId||botId){var e=_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.HX.chatbots.findIndex((function(e){return e.internalId===internalId})),t={internalId,botId,chatId,customId,open:function(){setTasks((function(e){return[].concat(_toConsumableArray(e),[{action:"open"}])}))},close:function(){setTasks((function(e){return[].concat(_toConsumableArray(e),[{action:"close"}])}))},clear:function(e){var t=(e||{}).chatId,r=void 0===t?null:t;setTasks((function(e){return[].concat(_toConsumableArray(e),[{action:"clear",data:{chatId:r}}])}))},toggle:function(){setTasks((function(e){return[].concat(_toConsumableArray(e),[{action:"toggle"}])}))},ask:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];setTasks((function(r){return[].concat(_toConsumableArray(r),[{action:"ask",data:{text:e,submit:t}}])}))},lock:function(){setLocked(!0)},unlock:function(){setLocked(!1)},setShortcuts:function(e){setTasks((function(t){return[].concat(_toConsumableArray(t),[{action:"setShortcuts",data:e}])}))},setBlocks:function(e){setTasks((function(t){return[].concat(_toConsumableArray(t),[{action:"setBlocks",data:e}])}))},addBlock:function(e){setTasks((function(t){return[].concat(_toConsumableArray(t),[{action:"addBlock",data:e}])}))},removeBlockById:function(e){setTasks((function(t){return[].concat(_toConsumableArray(t),[{action:"removeBlockById",data:e}])}))},getBlocks:function(){return blocks},setContext:function(e){var t=e.chatId,r=e.messages;setTasks((function(e){return[].concat(_toConsumableArray(e),[{action:"setContext",data:{chatId:t,messages:r}}])}))}};-1!==e?_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.HX.chatbots[e]=t:_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.HX.chatbots.push(t)}}),[botId,chatId,customId,internalId]),useEffect((function(){busy?startChrono():(!isMobile&&hasFocusRef.current&&chatbotInputRef.current.focusInput(),stopChrono())}),[busy,startChrono,stopChrono,isMobile]);var saveMessages=useCallback((function(e){localStorageKey&&localStorage.setItem(localStorageKey,(0,_neko_ui__WEBPACK_IMPORTED_MODULE_3__.F1)({chatId,messages:e}))}),[localStorageKey,chatId]),resetError=function(){setError(null)};useEffect((function(){var e=[];if(localStorageKey&&(e=localStorage.getItem(localStorageKey)))return e=JSON.parse(e),setMessages(e.messages),void setChatId(e.chatId);resetMessages()}),[botId]);var handleActions=useCallback((function(actions,lastMessage){actions=actions||[];var callsCount=0,_iterator=_createForOfIteratorHelper(actions),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var action=_step.value;if("function"===action.type){var data=action.data||{},_data$name=data.name,name=void 0===_data$name?null:_data$name,_data$args=data.args,args=void 0===_data$args?[]:_data$args,finalArgs=args?Object.values(args).map((function(e){return JSON.stringify(e)})):[];try{debugMode&&console.log("[CHATBOT] CALL ".concat(name,"(").concat(finalArgs.join(", "),")")),eval("".concat(name,"(").concat(finalArgs.join(", "),")")),callsCount++}catch(e){console.error("Error while executing an action.",e)}}}}catch(e){_iterator.e(e)}finally{_iterator.f()}!lastMessage.content&&callsCount>0&&(lastMessage.content="*Done!*")}),[debugMode]),handleShortcuts=useCallback((function(e){setShortcuts(e||[])}),[]),handleBlocks=useCallback((function(e){setBlocks(e||[])}),[]);useEffect((function(){if(serverReply){setBusy(!1);var e=_toConsumableArray(messages),t=e.length>0?e[e.length-1]:null;if(!serverReply.success)return"assistant"===t.role&&t.isQuerying&&e.pop(),e.pop(),e.push({id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"system",content:serverReply.message,who:rawAiName,timestamp:(new Date).getTime()}),setMessages(e),void saveMessages(e);if("assistant"===t.role&&t.isQuerying)t.content=(0,_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.W5)("ai.reply",serverReply.reply,{chatId,botId}),serverReply.images&&(t.images=serverReply.images),t.timestamp=(new Date).getTime(),delete t.isQuerying,handleActions(null==serverReply?void 0:serverReply.actions,t),handleBlocks(null==serverReply?void 0:serverReply.blocks),handleShortcuts(null==serverReply?void 0:serverReply.shortcuts);else if("assistant"===t.role&&t.isStreaming)t.content=(0,_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.W5)("ai.reply",serverReply.reply,{chatId,botId}),serverReply.images&&(t.images=serverReply.images),t.timestamp=(new Date).getTime(),delete t.isStreaming,handleActions(null==serverReply?void 0:serverReply.actions,t),handleBlocks(null==serverReply?void 0:serverReply.blocks),handleShortcuts(null==serverReply?void 0:serverReply.shortcuts);else{var r={id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"assistant",content:(0,_app_chatbot_MwaiAPI__WEBPACK_IMPORTED_MODULE_2__.W5)("ai.reply",serverReply.reply,{botId,chatId,customId}),who:rawAiName,timestamp:(new Date).getTime()};serverReply.images&&(r.images=serverReply.images),handleActions(null==serverReply?void 0:serverReply.actions,r),handleBlocks(null==serverReply?void 0:serverReply.blocks),handleShortcuts(null==serverReply?void 0:serverReply.shortcuts),e.push(r)}setMessages(e),saveMessages(e)}}),[serverReply]);var onClear=useCallback(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(n.length>0&&void 0!==n[0]?n[0]:{}).chatId,(r=void 0===t?null:t)||(r=(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)()),e.next=4,setChatId(r);case 4:localStorageKey&&localStorage.removeItem(localStorageKey),resetMessages(),setInputText(""),setShortcuts([]),setBlocks([]);case 9:case"end":return e.stop()}}),e)}))),[botId]),onStartRealtimeSession=useCallback(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,a;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={botId,customId,contextId,chatId},null==restNonce){e.next=5;break}e.t0=restNonce,e.next=8;break;case 5:return e.next=7,refreshRestNonce();case 7:e.t0=e.sent;case 8:return r=e.t0,e.next=11,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)("".concat(restUrl,"/mwai-ui/v1/openai/realtime/start"),t,r);case 11:return n=e.sent,e.next=14,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(n);case 14:return a=e.sent,e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)}))),[botId,customId,contextId,chatId,restNonce,refreshRestNonce,restUrl]),onCommitStats=useCallback(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,a,o,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:null,e.prev=1,null==restNonce){e.next=6;break}e.t0=restNonce,e.next=9;break;case 6:return e.next=8,refreshRestNonce();case 8:e.t0=e.sent;case 9:return n=e.t0,e.next=12,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)("".concat(restUrl,"/mwai-ui/v1/openai/realtime/stats"),{botId,session:sessionId,refId:r||chatId,stats:t},n);case 12:return a=e.sent,e.next=15,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(a);case 15:return o=e.sent,e.abrupt("return",{success:o.success,message:o.message});case 19:return e.prev=19,e.t1=e.catch(1),console.error("Error while committing stats.",e.t1),e.abrupt("return",{success:!1,message:"An error occurred while committing the stats."});case 23:case"end":return e.stop()}}),e,null,[[1,19]])})));return function(t){return e.apply(this,arguments)}}(),[botId,restNonce,refreshRestNonce,restUrl,sessionId,chatId]),onCommitDiscussions=useCallback(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,a,o,i=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:[],e.prev=1,null==restNonce){e.next=6;break}e.t0=restNonce,e.next=9;break;case 6:return e.next=8,refreshRestNonce();case 8:e.t0=e.sent;case 9:return r=e.t0,n={botId,session:sessionId,chatId,messages:null!=t?t:[]},e.next=13,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)("".concat(restUrl,"/mwai-ui/v1/openai/realtime/discussions"),n,r);case 13:return a=e.sent,e.next=16,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(a);case 16:return o=e.sent,e.abrupt("return",{success:o.success,message:o.message});case 20:return e.prev=20,e.t1=e.catch(1),console.error("Error while committing discussion.",e.t1),e.abrupt("return",{success:!1,message:"An error occurred while committing the discussion."});case 24:case"end":return e.stop()}}),e,null,[[1,20]])}))),[botId,chatId,restNonce,refreshRestNonce,restUrl,sessionId]),onRealtimeFunctionCallback=useCallback(function(){var _ref10=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(functionId,functionType,functionName,functionTarget,args){var body,finalArgs,nonce,res,data;return _regeneratorRuntime().wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(body={functionId,functionType,functionName,functionTarget,arguments:args},"js"!==functionTarget){_context6.next=15;break}return finalArgs=args?Object.values(args).map((function(e){return JSON.stringify(e)})):[],_context6.prev=3,debugMode&&console.log("[CHATBOT] CALL ".concat(functionName,"(").concat(finalArgs.join(", "),")")),eval("".concat(functionName,"(").concat(finalArgs.join(", "),")")),_context6.abrupt("return",{success:!0,message:"The function was executed",data:null});case 9:return _context6.prev=9,_context6.t0=_context6.catch(3),console.error("Error while executing an action.",_context6.t0),_context6.abrupt("return",{success:!1,message:"An error occurred while executing the function.",data:null});case 13:_context6.next=30;break;case 15:if(null==restNonce){_context6.next=19;break}_context6.t1=restNonce,_context6.next=22;break;case 19:return _context6.next=21,refreshRestNonce();case 21:_context6.t1=_context6.sent;case 22:return nonce=_context6.t1,_context6.next=25,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)("".concat(restUrl,"/mwai-ui/v1/openai/realtime/call"),body,nonce);case 25:return res=_context6.sent,_context6.next=28,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(res);case 28:return data=_context6.sent,_context6.abrupt("return",data);case 30:return _context6.abrupt("return",null);case 31:case"end":return _context6.stop()}}),_callee6,null,[[3,9]])})));return function(e,t,r,n,a){return _ref10.apply(this,arguments)}}(),[restNonce,refreshRestNonce,restUrl,debugMode]),onSubmit=useCallback(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,a,o,i,s,c,u,l,p,d,f,h,m,y;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!busy){e.next=3;break}return console.error("AI Engine: There is already a query in progress."),e.abrupt("return");case 3:if("string"!=typeof t&&(t=inputText),n=uploadedFile,a=null==uploadedFile?void 0:uploadedFile.uploadedUrl,o=null==uploadedFile||null===(r=uploadedFile.localFile)||void 0===r?void 0:r.type,i=!!o&&o.startsWith("image"),s=t,a&&(s=i?"![Uploaded Image](".concat(a,")\n").concat(t):"[Uploaded File](".concat(a,")\n").concat(t)),setBusy(!0),setInputText(""),setShortcuts([]),setBlocks([]),resetUploadedFile(),c=[].concat(_toConsumableArray(messages),[{id:(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),role:"user",content:s,who:rawUserName,timestamp:(new Date).getTime()}]),saveMessages(c),u=(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.vx)(),l=[].concat(_toConsumableArray(c),[{id:u,role:"assistant",content:null,who:rawAiName,timestamp:null,isQuerying:!stream,isStreaming:!!stream}]),setMessages(l),p=_objectSpread({botId,customId,session:sessionId,chatId,contextId,messages,newMessage:t,newFileId:null==n?void 0:n.uploadedId,stream},atts),e.prev=21,debugMode&&console.log("[CHATBOT] OUT: ",p),d=stream?function(e){setMessages((function(t){var r=_toConsumableArray(t),n=r.length>0?r[r.length-1]:null;return n&&n.id===u&&(n.content=e,n.timestamp=(new Date).getTime()),r}))}:null,null==restNonce){e.next=28;break}e.t0=restNonce,e.next=31;break;case 28:return e.next=30,refreshRestNonce();case 30:e.t0=e.sent;case 31:return f=e.t0,e.next=34,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.ti)("".concat(restUrl,"/mwai-ui/v1/chats/submit"),p,f,stream);case 34:return h=e.sent,e.next=37,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.Pn)(h,d,debugMode?"CHATBOT":null);case 37:if((m=e.sent).success||!m.message){e.next=47;break}return setError(m.message),(y=_toConsumableArray(l)).pop(),y.pop(),setMessages(y),saveMessages(y),setBusy(!1),e.abrupt("return");case 47:setServerReply(m),e.next=54;break;case 50:e.prev=50,e.t1=e.catch(21),console.error("An error happened in the handling of the chatbot response.",{err:e.t1}),setBusy(!1);case 54:case"end":return e.stop()}}),e,null,[[21,50]])})));return function(t){return e.apply(this,arguments)}}(),[busy,uploadedFile,messages,saveMessages,stream,botId,customId,sessionId,chatId,contextId,atts,inputText,debugMode,restNonce,refreshRestNonce,restUrl]),onSubmitAction=useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(null==uploadedFile||!uploadedFile.uploadedId);hasFocusRef.current=document.activeElement===chatbotInputRef.current.currentElement(),e?onSubmit(e):(t||inputText.length>0)&&onSubmit(inputText)}),[inputText,onSubmit,null==uploadedFile?void 0:uploadedFile.uploadedId]),onFileUpload=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var r,n,a,o,i,s,c=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:"N/A",n=c.length>2&&void 0!==c[2]?c[2]:"N/A",e.prev=2,null!==t){e.next=6;break}return resetUploadedFile(),e.abrupt("return");case 6:if(a={type:r,purpose:n},o="".concat(restUrl,"/mwai-ui/v1/files/upload"),null==restNonce){e.next=12;break}e.t0=restNonce,e.next=15;break;case 12:return e.next=14,refreshRestNonce();case 14:e.t0=e.sent;case 15:return i=e.t0,e.next=18,(0,_app_helpers__WEBPACK_IMPORTED_MODULE_1__.uE)(o,t,i,(function(e){setUploadedFile({localFile:t,uploadedId:null,uploadedUrl:null,uploadProgress:e})}),a);case 18:s=e.sent,setUploadedFile({localFile:t,uploadedId:s.data.id,uploadedUrl:s.data.url,uploadProgress:null}),e.next=27;break;case 22:e.prev=22,e.t1=e.catch(2),console.error("onFileUpload Error",e.t1),setError(e.t1.message||"An unknown error occurred"),resetUploadedFile();case 27:case"end":return e.stop()}}),e,null,[[2,22]])})));return function(t){return e.apply(this,arguments)}}(),onUploadFile=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return error&&resetError(),e.abrupt("return",onFileUpload(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),resetUploadedFile=function(){setUploadedFile({localFile:null,uploadedId:null,uploadedUrl:null,uploadProgress:null})},runTimer=useCallback((function(){var e=setTimeout((function(){setOpen((function(e){return e||setShowIconMessage(!0),e}))}),1e3*iconTextDelay);return function(){return clearTimeout(e)}}),[iconText,iconTextDelay]);useEffect((function(){if(iconText&&!iconTextDelay)setShowIconMessage(!0);else if(iconText&&iconTextDelay)return runTimer()}),[iconText]);var _useState37=useState([]),_useState38=_slicedToArray(_useState37,2),tasks=_useState38[0],setTasks=_useState38[1],runTasks=useCallback(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,r,n,a,o,i,s,c,u,l,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:tasks.length>0&&("ask"===(t=tasks[0]).action?(r=t.data,n=r.text,r.submit?onSubmit(n):setInputText(n)):"toggle"===t.action?setOpen((function(e){return!e})):"open"===t.action?setOpen(!0):"close"===t.action?setOpen(!1):"clear"===t.action?(a=t.data.chatId,onClear({chatId:a})):"setContext"===t.action?(o=t.data,i=o.chatId,s=o.messages,setChatId(i),setMessages(s)):"setShortcuts"===t.action?(c=t.data,handleShortcuts(c)):"setBlocks"===t.action?(u=t.data,handleBlocks(u)):"addBlock"===t.action?(l=t.data,setBlocks((function(e){return[].concat(_toConsumableArray(e),[l])}))):"removeBlockById"===t.action&&(p=t.data,setBlocks((function(e){return e.filter((function(e){return e.id!==p}))}))),setTasks((function(e){return e.slice(1)})));case 1:case"end":return e.stop()}}),e)}))),[tasks,onClear,onSubmit,setChatId,setInputText,setMessages,setOpen,handleShortcuts,handleBlocks]);useEffect((function(){runTasks()}),[runTasks]);var actions={setInputText,saveMessages,setMessages,resetMessages,resetError,onClear,onSubmit,onSubmitAction,onFileUpload,onUploadFile,setOpen,setWindowed,setShowIconMessage,setIsListening,setDraggingType,setIsBlocked,onStartRealtimeSession,onRealtimeFunctionCallback,onCommitStats,onCommitDiscussions},state={theme,botId,customId,userData,pluginUrl,inputText,messages,shortcuts,blocks,busy,error,setBusy,typewriter,speechRecognition,speechSynthesis,virtualKeyboardFix,localMemory,isRealtime,imageUpload,fileUpload,uploadedFile,fileSearch,textSend,textClear,textInputMaxLength,textInputPlaceholder,textCompliance,aiName,userName,guestName,aiAvatar,userAvatar,guestAvatar,aiAvatarUrl,userAvatarUrl,guestAvatarUrl,isWindow,copyButton,headerSubtitle,fullscreen,icon,iconText,iconAlt,iconPosition,iconBubble,cssVariables,iconUrl,chatbotInputRef,conversationRef,isMobile,open,locked,windowed,showIconMessage,timeElapsed,isListening,speechRecognitionAvailable,uploadIconPosition,submitButtonConf,draggingType,isBlocked,busyNonce};return React.createElement(ChatbotContext.Provider,{value:{state,actions}},children)}},137:(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,"string");if("object"!=n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:String(t)}r.d(t,{HX:()=>s,W5:()=>c});var i=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"undefined"!=typeof window&&window.MwaiAPI)return window.MwaiAPI;this.chatbots=[],this.forms=[],this.filters={},this.actions={},"undefined"!=typeof window&&(window.MwaiAPI=this)}var t,r;return t=e,r=[{key:"getChatbot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this.chatbots.find((function(t){return t.botId===e||t.customId===e})):this.chatbots[0]}},{key:"getForm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this.forms.find((function(t){return t.formId===e})):this.forms[0]}},{key:"addFilter",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;this.filters[e]||(this.filters[e]=[]),this.filters[e].push({callback:t,priority:r}),this.filters[e].sort((function(e,t){return e.priority-t.priority}))}},{key:"applyFilters",value:function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return this.filters[e]?this.filters[e].reduce((function(e,t){return t.callback.apply(t,[e].concat(n))}),t):t}},{key:"addAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;this.actions[e]||(this.actions[e]=[]),this.actions[e].push({callback:t,priority:r}),this.actions[e].sort((function(e,t){return e.priority-t.priority}))}},{key:"doAction",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.actions[e]&&this.actions[e].forEach((function(e){e.callback.apply(e,r)}))}}],r&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),s=function(){if("undefined"!=typeof window&&window.MwaiAPI)return window.MwaiAPI;var e=new i;return"undefined"!=typeof window&&(window.MwaiAPI=e),e}(),c=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return s.applyFilters.apply(s,[e,t].concat(n))}},728:(e,t,r)=>{r.d(t,{tm:()=>y,bE:()=>S,Mc:()=>w,mv:()=>v,_$:()=>x,dh:()=>g,gR:()=>b,$$:()=>_,Vw:()=>C,kW:()=>R});const n=(0,r(407).A)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);var a=["active","disabled"],o=["if","className","disableTransition","children"];function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c.apply(this,arguments)}function u(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=wp.element,p=l.useState,d=l.useMemo,f=l.useEffect,h=l.useRef,m=l.useCallback,y=function(e){var t=e.active,r=e.disabled,o=u(e,a);return React.createElement("div",c({active:t?"true":"false",disabled:r},o),React.createElement(n,{size:"24"}))};function _(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=h();f((function(){n.current=t}),[t]),f((function(){if(null!==e&&r){var t=setInterval((function(){n.current()}),e);return function(){return clearInterval(t)}}}),[e,r])}var b=function(){return d((function(){return function(e,t){return Array.isArray(e)||(e=[e]),t&&Object.entries(t).forEach((function(t){var r=i(t,2),n=r[0];r[1]&&e.push(n)})),e.join(" ")}}),[])};function v(e){return!(!e||"string"!=typeof e)&&0===e.indexOf("http")}function g(){var e=i(p(null),2),t=e[0],r=e[1],n=h(null);return f((function(){return function(){clearInterval(n.current)}}),[]),{timeElapsed:t,startChrono:function(){if(null===n.current){var e=Date.now();n.current=setInterval((function(){var t,n,a,o=Math.floor((Date.now()-e)/1e3);r((t=o,n=Math.floor(t/60),a=t%60,"".concat(n,":").concat(a.toString().padStart(2,"0"))))}),500)}},stopChrono:function(){clearInterval(n.current),n.current=null,r(null)}}}var w=function(e,t){return"string"==typeof e&&t?(Object.entries(t).forEach((function(t){var r=i(t,2),n=r[0],a=r[1];e=e.replace(new RegExp("{".concat(n,"}"),"g"),a)})),e):e},x=function(e){var t,r,n,a,o,i,s,c,u,l,p,d,f,h,m,y,_,b,v,g,x,C,S,R,E,I,k,A,T,O,P,L,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],U=null!==(t=null===(r=e.guestName)||void 0===r?void 0:r.trim())&&void 0!==t?t:"",D=null!==(n=null===(a=e.textSend)||void 0===a?void 0:a.trim())&&void 0!==n?n:"",M=null!==(o=null===(i=e.textClear)||void 0===i?void 0:i.trim())&&void 0!==o?o:"",N=parseInt(e.textInputMaxLength),B=null!==(s=null===(c=e.textInputPlaceholder)||void 0===c?void 0:c.trim())&&void 0!==s?s:"",F=null!==(u=null===(l=e.textCompliance)||void 0===l?void 0:l.trim())&&void 0!==u?u:"",z="",W=Boolean(e.window),$=Boolean(e.copyButton),H=Boolean(e.fullscreen),G=null!==(p=null===(d=e.icon)||void 0===d?void 0:d.trim())&&void 0!==p?p:"",K=null!==(f=null===(h=e.iconText)||void 0===h?void 0:h.trim())&&void 0!==f?f:"",V=parseInt(e.iconTextDelay||1),q=null!==(m=null===(y=e.iconAlt)||void 0===y?void 0:y.trim())&&void 0!==m?m:"",J=null!==(_=null===(b=e.iconPosition)||void 0===b?void 0:b.trim())&&void 0!==_?_:"",Q=Boolean(e.iconBubble),X=null!==(v=null===(g=e.aiName)||void 0===g?void 0:g.trim())&&void 0!==v?v:"",Y=null!==(x=null===(C=e.userName)||void 0===C?void 0:C.trim())&&void 0!==x?x:"",Z=Boolean(null==e?void 0:e.aiAvatar),ee=Boolean(null==e?void 0:e.userAvatar),te=Boolean(null==e?void 0:e.guestAvatar),re=Z?null!==(S=null==e||null===(R=e.aiAvatarUrl)||void 0===R?void 0:R.trim())&&void 0!==S?S:"":null,ne=ee?null!==(E=null==e||null===(I=e.userAvatarUrl)||void 0===I?void 0:I.trim())&&void 0!==E?E:"":null,ae=te?null!==(k=null==e||null===(A=e.guestAvatarUrl)||void 0===A?void 0:A.trim())&&void 0!==k?k:"":null,oe=Boolean(e.localMemory),ie=Boolean(e.imageUpload),se=Boolean(e.fileUpload),ce=Boolean(e.fileSearch),ue=null!==(T=null===(O=e.mode)||void 0===O?void 0:O.trim())&&void 0!==T?T:"chat";return z=null===e.headerSubtitle||void 0===e.headerSubtitle?"Discuss with":null!==(P=null===(L=e.headerSubtitle)||void 0===L?void 0:L.trim())&&void 0!==P?P:"",j&&(F=w(F,j),K=w(K,j)),{textSend:D,textClear:M,textInputMaxLength:N,textInputPlaceholder:B,textCompliance:F,mode:ue,window:W,copyButton:$,fullscreen:H,localMemory:oe,imageUpload:ie,fileUpload:se,fileSearch:ce,icon:G,iconText:K,iconTextDelay:V,iconAlt:q,iconPosition:J,iconBubble:Q,headerSubtitle:z,aiName:X,userName:Y,guestName:U,aiAvatar:Z,userAvatar:ee,guestAvatar:te,aiAvatarUrl:re,userAvatarUrl:ne,guestAvatarUrl:ae}},C=function(e){var t=i(p(!1),2),r=t[0],n=t[1],a=i(p(!1),2),o=a[0],s=a[1];return f((function(){"undefined"!=typeof window&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)&&s(!0)}),[]),f((function(){if(o){var t=new(window.SpeechRecognition||window.webkitSpeechRecognition),a=null;return navigator.userAgent.toLowerCase().indexOf("android")>-1?(t.interimResults=!1,t.continuous=!1,a=function(t){var r=Array.from(t.results).filter((function(e){return e.isFinal})).map((function(e){return e[0].transcript})).join("");e(r),n(!1)}):(t.interimResults=!0,t.continuous=!0,a=function(t){var r=Array.from(t.results).map((function(e){return e[0]})).map((function(e){return e.transcript})).join("");e(r)}),r?(t.addEventListener("result",a),t.start()):(t.removeEventListener("result",a),t.abort()),function(){t.abort()}}}),[r,o]),{isListening:r,setIsListening:n,speechRecognitionAvailable:o}},S=function(e){var t=e.if,r=e.className,n=e.disableTransition,a=void 0!==n&&n,s=e.children,l=u(e,o),d=i(p(!1),2),h=d[0],m=d[1],y=i(p("mwai-transition"),2),_=y[0],b=y[1];return f((function(){a?m(t):t?(m(!0),setTimeout((function(){b("mwai-transition mwai-transition-visible")}),150)):b("mwai-transition")}),[t,a]),h?React.createElement("div",c({className:"".concat(r," ").concat(a?"":_),onTransitionEnd:function(){"mwai-transition"!==_||a||m(!1)}},l),s):null},R=function(){var e=i(p(window.visualViewport.height),2),t=e[0],r=e[1],n=d((function(){return/Android/.test(navigator.userAgent)}),[]),a=d((function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}),[]),o=h(window.visualViewport),s=m((function(){r(o.current.height)}),[]);return f((function(){var e=o.current;return e.addEventListener("resize",s),a?(window.addEventListener("resize",s),document.addEventListener("focusin",s)):e.addEventListener("scroll",s),function(){e.removeEventListener("resize",s),a?(window.removeEventListener("resize",s),document.removeEventListener("focusin",s)):e.removeEventListener("scroll",s)}}),[s,a]),{viewportHeight:t,isIOS:a,isAndroid:n}}},678:(e,t,r)=>{r.d(t,{Pn:()=>f,Ve:()=>x,rn:()=>g,ti:()=>m,uE:()=>_,vx:()=>v});var n=r(296);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(){o=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var a=t&&t.prototype instanceof v?t:v,o=Object.create(a.prototype),s=new P(n||[]);return i(o,"_invoke",{value:k(e,r,s)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",m="suspendedYield",y="executing",_="completed",b={};function v(){}function g(){}function w(){}var x={};p(x,c,(function(){return this}));var C=Object.getPrototypeOf,S=C&&C(C(L([])));S&&S!==r&&n.call(S,c)&&(x=S);var R=w.prototype=v.prototype=Object.create(x);function E(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function r(o,i,s,c){var u=f(e[o],e,i);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==a(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var o;i(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function k(t,r,n){var a=h;return function(o,i){if(a===y)throw new Error("Generator is already running");if(a===_){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var c=A(s,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===h)throw a=_,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=y;var u=f(t,r,n);if("normal"===u.type){if(a=n.done?_:m,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=_,n.method="throw",n.arg=u.arg)}}}function A(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,A(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=f(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function L(t){if(t||""===t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(a(t)+" is not iterable")}return g.prototype=w,i(R,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:g,configurable:!0}),g.displayName=p(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,p(e,l,"GeneratorFunction")),e.prototype=Object.create(R),e},t.awrap=function(e){return{__await:e}},E(I.prototype),p(I.prototype,u,(function(){return this})),t.AsyncIterator=I,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new I(d(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(R),p(R,l,"Generator"),p(R,c,(function(){return this})),p(R,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=L,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return s.type="throw",s.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:L(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},t}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){c(o,n,a,i,s,"next",e)}function s(e){c(o,n,a,i,s,"throw",e)}i(void 0)}))}}var l=wp.element,p=(l.useMemo,l.useEffect),d=l.useState;function f(e,t){return h.apply(this,arguments)}function h(){return h=u(o().mark((function e(t,r){var n,a,i,s,c,u,l,p,d,f,h,m,y,_,b=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=b.length>2&&void 0!==b[2]?b[2]:null,r){e.next=14;break}return e.prev=2,e.next=5,t.json();case 5:return a=e.sent,n&&console.log("[".concat(n,"] IN: "),a),e.abrupt("return",a);case 10:return e.prev=10,e.t0=e.catch(2),console.error("Could not parse the regular response.",{err:e.t0,data}),e.abrupt("return",{success:!1,message:"Could not parse the regular response."});case 14:i=t.body.getReader(),s=new TextDecoder("utf-8"),c="",u="";case 18:return e.next=21,i.read();case 21:if(l=e.sent,p=l.value,d=l.done,c+=s.decode(p,{stream:!0}),!d){e.next=27;break}return e.abrupt("break",68);case 27:f=c.split("\n"),h=0;case 29:if(!(h<f.length-1)){e.next=65;break}if(0===f[h].indexOf("data: ")){e.next=32;break}return e.abrupt("continue",62);case 32:if("live"!==(m=JSON.parse(f[h].replace("data: ",""))).type){e.next=39;break}n&&console.log("[".concat(n," STREAM] LIVE: "),m),u+=m.data,r&&r(u,m.data),e.next=62;break;case 39:if("error"!==m.type){e.next=51;break}return e.prev=40,n&&console.error("[".concat(n," STREAM] ERROR: "),m.data),e.abrupt("return",{success:!1,message:m.data});case 45:return e.prev=45,e.t1=e.catch(40),console.error("Could not parse the 'error' stream.",{err:e.t1,data:m}),e.abrupt("return",{success:!1,message:"Could not parse the 'error' stream."});case 49:e.next=62;break;case 51:if("end"!==m.type){e.next=62;break}return e.prev=52,y=JSON.parse(m.data),n&&console.log("[".concat(n," STREAM] END: "),y),e.abrupt("return",y);case 58:return e.prev=58,e.t2=e.catch(52),console.error("Could not parse the 'end' stream.",{err:e.t2,data:m}),e.abrupt("return",{success:!1,message:"Could not parse the 'end' stream."});case 62:h++,e.next=29;break;case 65:c=f[f.length-1],e.next=18;break;case 68:return e.prev=68,_=JSON.parse(c),n&&console.log("[".concat(n," STREAM] IN: "),_),e.abrupt("return",_);case 74:return e.prev=74,e.t3=e.catch(68),console.error("Could not parse the buffer.",{err:e.t3,buffer:c}),e.abrupt("return",{success:!1,message:"Could not parse the buffer."});case 78:case"end":return e.stop()}}),e,null,[[2,10],[40,45],[52,58],[68,74]])}))),h.apply(this,arguments)}function m(e,t,r,n){return y.apply(this,arguments)}function y(){return(y=u(o().mark((function e(t,r,a,i){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={"Content-Type":"application/json"},a&&(s["X-WP-Nonce"]=a),i&&(s.Accept="text/event-stream"),e.next=5,fetch("".concat(t),{method:"POST",headers:s,body:(0,n.F1)(r)});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,r,n){return b.apply(this,arguments)}function b(){return b=u(o().mark((function e(t,r,n,a){var s,c=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.length>4&&void 0!==c[4]?c[4]:{},e.abrupt("return",new Promise((function(e,o){var c=new FormData;c.append("file",r);for(var u=0,l=Object.entries(s);u<l.length;u++){var p=i(l[u],2),d=p[0],f=p[1];c.append(d,f)}var h=new XMLHttpRequest;h.open("POST",t,!0),n&&h.setRequestHeader("X-WP-Nonce",n),h.upload.onprogress=function(e){if(e.lengthComputable&&a){var t=e.loaded/e.total*100;a(t)}},h.onload=function(){if(h.status>=200&&h.status<300)try{var t=JSON.parse(h.responseText);e(t)}catch(e){o({status:h.status,statusText:h.statusText,error:"The server response is not valid JSON"})}else{try{var r=JSON.parse(h.responseText);return void o({status:h.status,message:r.message})}catch(e){}o({status:h.status,statusText:h.statusText})}},h.onerror=function(){o({status:h.status,statusText:h.statusText})},h.send(c)})));case 2:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function v(){return Math.random().toString(36).substring(2)}var g=function(){var e=i(d(!0),2),t=e[0],r=e[1];p((function(){var e=setTimeout((function(){var e=setInterval((function(){r((function(e){return!e}))}),500);return function(){return clearInterval(e)}}),200);return function(){return clearTimeout(e)}}),[]);var n={opacity:t?1:0,width:"1px",height:"1em",borderLeft:"8px solid",marginLeft:"2px"};return React.createElement("span",{style:n})},w=/([\u2700-\u27BF]|[\uE000-\uF8FF]|[\uD800-\uDFFF]|[\uFE00-\uFE0F]|[\u1F100-\u1F1FF]|[\u1F200-\u1F2FF]|[\u1F300-\u1F5FF]|[\u1F600-\u1F64F]|[\u1F680-\u1F6FF]|[\u1F700-\u1F77F]|[\u1F780-\u1F7FF]|[\u1F800-\u1F8FF]|[\u1F900-\u1F9FF]|[\u1FA00-\u1FA6F])/;function x(e){return e&&2===e.length&&w.test(e)}},296:(e,t,r)=>{r.d(t,{F1:()=>i});var n=r(594);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}var o=function(e){var t=[];return function(r,n){if("object"===a(n)&&null!==n){if(-1!==t.indexOf(n)){if(!e)throw console.warn("Circular reference found.",{key:r,value:n,cache:t,cacheIndex:t.indexOf(n)}),new Error("Circular reference found. Cancelled.");return}t.push(n)}return n}};function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return JSON.stringify(e,o(r),t)}r.n(n)().Component},407:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(594);const a=(...e)=>e.filter(((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t)).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const i=(0,n.forwardRef)((({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:s="",children:c,iconNode:u,...l},p)=>(0,n.createElement)("svg",{ref:p,...o,width:t,height:t,stroke:e,strokeWidth:i?24*Number(r)/Number(t):r,className:a("lucide",s),...l},[...u.map((([e,t])=>(0,n.createElement)(e,t))),...Array.isArray(c)?c:[c]]))),s=(e,t)=>{const r=(0,n.forwardRef)((({className:r,...o},s)=>{return(0,n.createElement)(i,{ref:s,iconNode:t,className:a(`lucide-${c=e,c.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,r),...o});var c}));return r.displayName=`${e}`,r}},594:e=>{e.exports=React}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},ChatbotContext=__webpack_require__(469),external_React_=__webpack_require__(594);function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t.apply(this,arguments)}const n=["children","options"],r={blockQuote:"0",breakLine:"1",breakThematic:"2",codeBlock:"3",codeFenced:"4",codeInline:"5",footnote:"6",footnoteReference:"7",gfmTask:"8",heading:"9",headingSetext:"10",htmlBlock:"11",htmlComment:"12",htmlSelfClosing:"13",image:"14",link:"15",linkAngleBraceStyleDetector:"16",linkBareUrlDetector:"17",linkMailtoDetector:"18",newlineCoalescer:"19",orderedList:"20",paragraph:"21",ref:"22",refImage:"23",refLink:"24",table:"25",tableSeparator:"26",text:"27",textBolded:"28",textEmphasized:"29",textEscaped:"30",textMarked:"31",textStrikethroughed:"32",unorderedList:"33"};var i;!function(e){e[e.MAX=0]="MAX",e[e.HIGH=1]="HIGH",e[e.MED=2]="MED",e[e.LOW=3]="LOW",e[e.MIN=4]="MIN"}(i||(i={}));const l=["allowFullScreen","allowTransparency","autoComplete","autoFocus","autoPlay","cellPadding","cellSpacing","charSet","className","classId","colSpan","contentEditable","contextMenu","crossOrigin","encType","formAction","formEncType","formMethod","formNoValidate","formTarget","frameBorder","hrefLang","inputMode","keyParams","keyType","marginHeight","marginWidth","maxLength","mediaGroup","minLength","noValidate","radioGroup","readOnly","rowSpan","spellCheck","srcDoc","srcLang","srcSet","tabIndex","useMap"].reduce(((e,t)=>(e[t.toLowerCase()]=t,e)),{for:"htmlFor"}),a={amp:"&",apos:"'",gt:">",lt:"<",nbsp:"",quot:""},o=["style","script"],c=/([-A-Z0-9_:]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|(?:\{((?:\\.|{[^}]*?}|[^}])*)\})))?/gi,s=/mailto:/i,d=/\n{2,}$/,u=/^(\s*>[\s\S]*?)(?=\n{2,})/,p=/^ *> ?/gm,f=/^ {2,}\n/,h=/^(?:( *[-*_])){3,} *(?:\n *)+\n/,m=/^\s*(`{3,}|~{3,}) *(\S+)?([^\n]*?)?\n([\s\S]+?)\s*\1 *(?:\n *)*\n?/,g=/^(?: {4}[^\n]+\n*)+(?:\n *)+\n?/,y=/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,k=/^(?:\n *)*\n/,chatbot_x=/\r\n?/g,b=/^\[\^([^\]]+)](:(.*)((\n+ {4,}.*)|(\n(?!\[\^).+))*)/,v=/^\[\^([^\]]+)]/,S=/\f/g,E=/^---[ \t]*\n(.|\n)*\n---[ \t]*\n/,$=/^\s*?\[(x|\s)\]/,w=/^ *(#{1,6}) *([^\n]+?)(?: +#*)?(?:\n *)*(?:\n|$)/,C=/^ *(#{1,6}) +([^\n]+?)(?: +#*)?(?:\n *)*(?:\n|$)/,z=/^([^\n]+)\n *(=|-){3,} *(?:\n *)+\n/,L=/^ *(?!<[a-z][^ >/]* ?\/>)<([a-z][^ >/]*) ?((?:[^>]*[^/])?)>\n?(\s*(?:<\1[^>]*?>[\s\S]*?<\/\1>|(?!<\1\b)[\s\S])*?)<\/\1>(?!<\/\1>)\n*/i,A=/&([a-z0-9]+|#[0-9]{1,6}|#x[0-9a-fA-F]{1,6});/gi,T=/^<!--[\s\S]*?(?:-->)/,O=/^(data|aria|x)-[a-z_][a-z\d_.-]*$/,B=/^ *<([a-z][a-z0-9:]*)(?:\s+((?:<.*?>|[^>])*))?\/?>(?!<\/\1>)(\s*\n)?/i,M=/^\{.*\}$/,R=/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,I=/^<([^ >]+@[^ >]+)>/,U=/^<([^ >]+:\/[^ >]+)>/,D=/-([a-z])?/gi,j=/^(.*\|.*)\n(?: *(\|? *[-:]+ *\|[-| :]*)\n((?:.*\|.*\n)*))?\n?/,N=/^\[([^\]]*)\]:\s+<?([^\s>]+)>?\s*("([^"]*)")?/,H=/^!\[([^\]]*)\] ?\[([^\]]*)\]/,F=/^\[([^\]]*)\] ?\[([^\]]*)\]/,P=/(\[|\])/g,_=/(\n|^[-*]\s|^#|^ {2,}|^-{2,}|^>\s)/,W=/\t/g,G=/(^ *\||\| *$)/g,Z=/^ *:-+: *$/,q=/^ *:-+ *$/,Q=/^ *-+: *$/,V="((?:\\[.*?\\][([].*?[)\\]]|<.*?>(?:.*?<.*?>)?|`.*?`|~~.*?~~|==.*?==|.|\\n)*?)",X=new RegExp(`^([*_])\\1${V}\\1\\1(?!\\1)`),J=new RegExp(`^([*_])${V}\\1(?!\\1|\\w)`),K=new RegExp(`^==${V}==`),Y=new RegExp(`^~~${V}~~`),ee=/^\\([^0-9A-Za-z\s])/,te=/^[\s\S]+?(?=[^0-9A-Z\s\u00c0-\uffff&#;.()'"]|\d+\.|\n\n| {2,}\n|\w+:\S|$)/i,ne=/^\n+/,re=/^([ \t]*)/,ie=/\\([^\\])/g,le=/ *\n+$/,ae=/(?:^|\n)( *)$/,oe="(?:\\d+\\.)",ce="(?:[*+-])";function se(e){return"( *)("+(1===e?oe:ce)+") +"}const de=se(1),ue=se(2);function pe(e){return new RegExp("^"+(1===e?de:ue))}const fe=pe(1),he=pe(2);function me(e){return new RegExp("^"+(1===e?de:ue)+"[^\\n]*(?:\\n(?!\\1"+(1===e?oe:ce)+" )[^\\n]*)*(\\n|$)","gm")}const ge=me(1),ye=me(2);function ke(e){const t=1===e?oe:ce;return new RegExp("^( *)("+t+") [\\s\\S]+?(?:\\n{2,}(?! )(?!\\1"+t+" (?!"+t+" ))\\n*|\\s*\\n*$)")}const xe=ke(1),be=ke(2);function ve(e,t){const n=1===t,a=n?xe:be,o=n?ge:ye,i=n?fe:he;return{match(e,t,r){const n=ae.exec(r);return n&&(t.list||!t.inline&&!t.simple)?a.exec(e=n[1]+e):null},order:1,parse(e,t,r){const a=n?+e[2]:void 0,s=e[0].replace(d,"\n").match(o);let c=!1;return{items:s.map((function(e,n){const a=i.exec(e)[0].length,o=new RegExp("^ {1,"+a+"}","gm"),u=e.replace(o,"").replace(i,""),l=n===s.length-1,p=-1!==u.indexOf("\n\n")||l&&c;c=p;const d=r.inline,f=r.list;let h;r.list=!0,p?(r.inline=!1,h=u.replace(le,"\n\n")):(r.inline=!0,h=u.replace(le,""));const m=t(h,r);return r.inline=d,r.list=f,m})),ordered:n,start:a}},render:(t,n,a)=>e(t.ordered?"ol":"ul",{key:a.key,start:t.type===r.orderedList?t.start:void 0},t.items.map((function(t,r){return e("li",{key:r},n(t,a))})))}}const Se=new RegExp("^\\[((?:\\[[^\\]]*\\]|[^\\[\\]]|\\](?=[^\\[]*\\]))*)\\]\\(\\s*<?((?:\\([^)]*\\)|[^\\s\\\\]|\\\\.)*?)>?(?:\\s+['\"]([\\s\\S]*?)['\"])?\\s*\\)"),Ee=/^!\[(.*?)\]\( *((?:\([^)]*\)|[^() ])*) *"?([^)"]*)?"?\)/,$e=[u,m,g,w,z,C,T,j,ge,xe,ye,be],we=[...$e,/^[^\n]+(?:  \n|\n{2,})/,L,B];function Ce(e){return e.replace(/[]/g,"a").replace(/[]/g,"c").replace(/[]/g,"d").replace(/[]/g,"e").replace(/[]/g,"i").replace(/[]/g,"n").replace(/[]/g,"o").replace(/[]/g,"u").replace(/[]/g,"y").replace(/[^a-z0-9- ]/gi,"").replace(/ /gi,"-").toLowerCase()}function ze(e){return Q.test(e)?"right":Z.test(e)?"center":q.test(e)?"left":null}function Le(e,t,n,a){const o=n.inTable;n.inTable=!0;let i=e.trim().split(/( *(?:`[^`]*`|<.*?>.*?<\/.*?>(?!<\/.*?>)|\\\||\|) *)/).reduce(((e,o)=>("|"===o.trim()?e.push(a?{type:r.tableSeparator}:{type:r.text,text:o}):""!==o&&e.push.apply(e,t(o,n)),e)),[]);n.inTable=o;let s=[[]];return i.forEach((function(e,t){e.type===r.tableSeparator?0!==t&&t!==i.length-1&&s.push([]):(e.type!==r.text||null!=i[t+1]&&i[t+1].type!==r.tableSeparator||(e.text=e.text.trimEnd()),s[s.length-1].push(e))})),s}function Ae(e,t,n){n.inline=!0;const a=e[2]?e[2].replace(G,"").split("|").map(ze):[],o=e[3]?function(e,t,r){return e.trim().split("\n").map((function(e){return Le(e,t,r,!0)}))}(e[3],t,n):[],i=Le(e[1],t,n,!!o.length);return n.inline=!1,o.length?{align:a,cells:o,header:i,type:r.table}:{children:i,type:r.paragraph}}function Te(e,t){return null==e.align[t]?{}:{textAlign:e.align[t]}}function Oe(e){return function(t,r){return r.inline?e.exec(t):null}}function Be(e){return function(t,r){return r.inline||r.simple?e.exec(t):null}}function Me(e){return function(t,r){return r.inline||r.simple?null:e.exec(t)}}function Re(e){return function(t){return e.exec(t)}}function Ie(e,t,r){if(t.inline||t.simple)return null;if(r&&!r.endsWith("\n"))return null;let n="";e.split("\n").every((e=>!$e.some((t=>t.test(e)))&&(n+=e+"\n",e.trim())));const a=n.trimEnd();return""==a?null:[n,a]}function Ue(e){try{if(decodeURIComponent(e).replace(/[^A-Za-z0-9/:]/g,"").match(/^\s*(javascript|vbscript|data(?!:image)):/i))return null}catch(e){return null}return e}function De(e){return e.replace(ie,"$1")}function je(e,t,r){const n=r.inline||!1,a=r.simple||!1;r.inline=!0,r.simple=!0;const o=e(t,r);return r.inline=n,r.simple=a,o}function Ne(e,t,r){const n=r.inline||!1,a=r.simple||!1;r.inline=!1,r.simple=!0;const o=e(t,r);return r.inline=n,r.simple=a,o}function He(e,t,r){const n=r.inline||!1;r.inline=!1;const a=e(t,r);return r.inline=n,a}const Fe=(e,t,r)=>({children:je(t,e[1],r)});function Pe(){return{}}function _e(){return null}function We(...e){return e.filter(Boolean).join(" ")}function Ge(e,t,r){let n=e;const a=t.split(".");for(;a.length&&(n=n[a[0]],void 0!==n);)a.shift();return n||r}function Ze(e="",n={}){function i(e,r,...a){const o=Ge(n.overrides,`${e}.props`,{});return n.createElement(function(e,t){const r=Ge(t,e);return r?"function"==typeof r||"object"==typeof r&&"render"in r?r:Ge(t,`${e}.component`,e):e}(e,n.overrides),t({},r,o,{className:We(null==r?void 0:r.className,o.className)||void 0}),...a)}function d(e){e=e.replace(E,"");let t=!1;n.forceInline?t=!0:n.forceBlock||(t=!1===_.test(e));const r=Z(Q(t?e:`${e.trimEnd().replace(ne,"")}\n\n`,{inline:t}));for(;"string"==typeof r[r.length-1]&&!r[r.length-1].trim();)r.pop();if(null===n.wrapper)return r;const a=n.wrapper||(t?"span":"div");let o;if(r.length>1||n.forceWrapper)o=r;else{if(1===r.length)return o=r[0],"string"==typeof o?i("span",{key:"outer"},o):o;o=null}return external_React_.createElement(a,{key:"outer"},o)}function x(e,t){const r=t.match(c);return r?r.reduce((function(t,r,a){const o=r.indexOf("=");if(-1!==o){const i=function(e){return-1!==e.indexOf("-")&&null===e.match(O)&&(e=e.replace(D,(function(e,t){return t.toUpperCase()}))),e}(r.slice(0,o)).trim(),s=function(e){const t=e[0];return('"'===t||"'"===t)&&e.length>=2&&e[e.length-1]===t?e.slice(1,-1):e}(r.slice(o+1).trim()),c=l[i]||i,u=t[c]=function(e,t,r,n){return"style"===t?r.split(/;\s?/).reduce((function(e,t){const r=t.slice(0,t.indexOf(":"));return e[r.trim().replace(/(-[a-z])/g,(e=>e[1].toUpperCase()))]=t.slice(r.length+1).trim(),e}),{}):"href"===t||"src"===t?n(r,e,t):(r.match(M)&&(r=r.slice(1,r.length-1)),"true"===r||"false"!==r&&r)}(e,i,s,n.sanitizer);"string"==typeof u&&(L.test(u)||B.test(u))&&(t[c]=external_React_.cloneElement(d(u.trim()),{key:a}))}else"style"!==r&&(t[l[r]||r]=!0);return t}),{}):null}n.overrides=n.overrides||{},n.sanitizer=n.sanitizer||Ue,n.slugify=n.slugify||Ce,n.namedCodesToUnicode=n.namedCodesToUnicode?t({},a,n.namedCodesToUnicode):a,n.createElement=n.createElement||external_React_.createElement;const G=[],V={},q={[r.blockQuote]:{match:Me(u),order:1,parse:(e,t,r)=>({children:t(e[0].replace(p,""),r)}),render:(e,t,r)=>i("blockquote",{key:r.key},t(e.children,r))},[r.breakLine]:{match:Re(f),order:1,parse:Pe,render:(e,t,r)=>i("br",{key:r.key})},[r.breakThematic]:{match:Me(h),order:1,parse:Pe,render:(e,t,r)=>i("hr",{key:r.key})},[r.codeBlock]:{match:Me(g),order:0,parse:e=>({lang:void 0,text:e[0].replace(/^ {4}/gm,"").replace(/\n+$/,"")}),render:(e,r,n)=>i("pre",{key:n.key},i("code",t({},e.attrs,{className:e.lang?`lang-${e.lang}`:""}),e.text))},[r.codeFenced]:{match:Me(m),order:0,parse:e=>({attrs:x("code",e[3]||""),lang:e[2]||void 0,text:e[4],type:r.codeBlock})},[r.codeInline]:{match:Be(y),order:3,parse:e=>({text:e[2]}),render:(e,t,r)=>i("code",{key:r.key},e.text)},[r.footnote]:{match:Me(b),order:0,parse:e=>(G.push({footnote:e[2],identifier:e[1]}),{}),render:_e},[r.footnoteReference]:{match:Oe(v),order:1,parse:e=>({target:`#${n.slugify(e[1],Ce)}`,text:e[1]}),render:(e,t,r)=>i("a",{key:r.key,href:n.sanitizer(e.target,"a","href")},i("sup",{key:r.key},e.text))},[r.gfmTask]:{match:Oe($),order:1,parse:e=>({completed:"x"===e[1].toLowerCase()}),render:(e,t,r)=>i("input",{checked:e.completed,key:r.key,readOnly:!0,type:"checkbox"})},[r.heading]:{match:Me(n.enforceAtxHeadings?C:w),order:1,parse:(e,t,r)=>({children:je(t,e[2],r),id:n.slugify(e[2],Ce),level:e[1].length}),render:(e,t,r)=>i(`h${e.level}`,{id:e.id,key:r.key},t(e.children,r))},[r.headingSetext]:{match:Me(z),order:0,parse:(e,t,n)=>({children:je(t,e[1],n),level:"="===e[2]?1:2,type:r.heading})},[r.htmlBlock]:{match:Re(L),order:1,parse(e,t,r){const[,n]=e[3].match(re),a=new RegExp(`^${n}`,"gm"),i=e[3].replace(a,""),s=(c=i,we.some((e=>e.test(c)))?He:je);var c;const u=e[1].toLowerCase(),l=-1!==o.indexOf(u),p=(l?u:e[1]).trim(),d={attrs:x(p,e[2]),noInnerParse:l,tag:p};return r.inAnchor=r.inAnchor||"a"===u,l?d.text=e[3]:d.children=s(t,i,r),r.inAnchor=!1,d},render:(e,r,n)=>i(e.tag,t({key:n.key},e.attrs),e.text||r(e.children,n))},[r.htmlSelfClosing]:{match:Re(B),order:1,parse(e){const t=e[1].trim();return{attrs:x(t,e[2]||""),tag:t}},render:(e,r,n)=>i(e.tag,t({},e.attrs,{key:n.key}))},[r.htmlComment]:{match:Re(T),order:1,parse:()=>({}),render:_e},[r.image]:{match:Be(Ee),order:1,parse:e=>({alt:e[1],target:De(e[2]),title:e[3]}),render:(e,t,r)=>i("img",{key:r.key,alt:e.alt||void 0,title:e.title||void 0,src:n.sanitizer(e.target,"img","src")})},[r.link]:{match:Oe(Se),order:3,parse:(e,t,r)=>({children:Ne(t,e[1],r),target:De(e[2]),title:e[3]}),render:(e,t,r)=>i("a",{key:r.key,href:n.sanitizer(e.target,"a","href"),title:e.title},t(e.children,r))},[r.linkAngleBraceStyleDetector]:{match:Oe(U),order:0,parse:e=>({children:[{text:e[1],type:r.text}],target:e[1],type:r.link})},[r.linkBareUrlDetector]:{match:(e,t)=>t.inAnchor?null:Oe(R)(e,t),order:0,parse:e=>({children:[{text:e[1],type:r.text}],target:e[1],title:void 0,type:r.link})},[r.linkMailtoDetector]:{match:Oe(I),order:0,parse(e){let t=e[1],n=e[1];return s.test(n)||(n="mailto:"+n),{children:[{text:t.replace("mailto:",""),type:r.text}],target:n,type:r.link}}},[r.orderedList]:ve(i,1),[r.unorderedList]:ve(i,2),[r.newlineCoalescer]:{match:Me(k),order:3,parse:Pe,render:()=>"\n"},[r.paragraph]:{match:Ie,order:3,parse:Fe,render:(e,t,r)=>i("p",{key:r.key},t(e.children,r))},[r.ref]:{match:Oe(N),order:0,parse:e=>(V[e[1]]={target:e[2],title:e[4]},{}),render:_e},[r.refImage]:{match:Be(H),order:0,parse:e=>({alt:e[1]||void 0,ref:e[2]}),render:(e,t,r)=>V[e.ref]?i("img",{key:r.key,alt:e.alt,src:n.sanitizer(V[e.ref].target,"img","src"),title:V[e.ref].title}):null},[r.refLink]:{match:Oe(F),order:0,parse:(e,t,r)=>({children:t(e[1],r),fallbackChildren:t(e[0].replace(P,"\\$1"),r),ref:e[2]}),render:(e,t,r)=>V[e.ref]?i("a",{key:r.key,href:n.sanitizer(V[e.ref].target,"a","href"),title:V[e.ref].title},t(e.children,r)):i("span",{key:r.key},t(e.fallbackChildren,r))},[r.table]:{match:Me(j),order:1,parse:Ae,render(e,t,r){const n=e;return i("table",{key:r.key},i("thead",null,i("tr",null,n.header.map((function(e,a){return i("th",{key:a,style:Te(n,a)},t(e,r))})))),i("tbody",null,n.cells.map((function(e,a){return i("tr",{key:a},e.map((function(e,a){return i("td",{key:a,style:Te(n,a)},t(e,r))})))}))))}},[r.text]:{match:Re(te),order:4,parse:e=>({text:e[0].replace(A,((e,t)=>n.namedCodesToUnicode[t]?n.namedCodesToUnicode[t]:e))}),render:e=>e.text},[r.textBolded]:{match:Be(X),order:2,parse:(e,t,r)=>({children:t(e[2],r)}),render:(e,t,r)=>i("strong",{key:r.key},t(e.children,r))},[r.textEmphasized]:{match:Be(J),order:3,parse:(e,t,r)=>({children:t(e[2],r)}),render:(e,t,r)=>i("em",{key:r.key},t(e.children,r))},[r.textEscaped]:{match:Be(ee),order:1,parse:e=>({text:e[1],type:r.text})},[r.textMarked]:{match:Be(K),order:3,parse:Fe,render:(e,t,r)=>i("mark",{key:r.key},t(e.children,r))},[r.textStrikethroughed]:{match:Be(Y),order:3,parse:Fe,render:(e,t,r)=>i("del",{key:r.key},t(e.children,r))}};!0===n.disableParsingRawHTML&&(delete q[r.htmlBlock],delete q[r.htmlSelfClosing]);const Q=function(e){let t=Object.keys(e);function r(n,a){let o=[],i="";for(;n;){let s=0;for(;s<t.length;){const c=t[s],u=e[c],l=u.match(n,a,i);if(l){const e=l[0];n=n.substring(e.length);const t=u.parse(l,r,a);null==t.type&&(t.type=c),o.push(t),i=e;break}s++}}return o}return t.sort((function(t,r){let n=e[t].order,a=e[r].order;return n!==a?n-a:t<r?-1:1})),function(e,t){return r(function(e){return e.replace(chatbot_x,"\n").replace(S,"").replace(W,"    ")}(e),t)}}(q),Z=(ae=function(e,t){return function(r,n,a){const o=e[r.type].render;return t?t((()=>o(r,n,a)),r,n,a):o(r,n,a)}}(q,n.renderRule),function e(t,r={}){if(Array.isArray(t)){const n=r.key,a=[];let o=!1;for(let n=0;n<t.length;n++){r.key=n;const i=e(t[n],r),s="string"==typeof i;s&&o?a[a.length-1]+=i:null!==i&&a.push(i),o=s}return r.key=n,a}return ae(t,e,r)});var ae;const oe=d(e);return G.length?i("div",null,oe,i("footer",{key:"footer"},G.map((function(e){return i("div",{id:n.slugify(e.identifier,Ce),key:e.identifier},e.identifier,Z(Q(e.footnote,{inline:!0})))})))):oe}const index_modern=e=>{let{children:t="",options:r}=e,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||(a[r]=e[r]);return a}(e,n);return external_React_.cloneElement(Ze(t,r),a)};var helpers=__webpack_require__(728);function typed_module_t(){return typed_module_t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},typed_module_t.apply(this,arguments)}var typed_module_s={strings:["These are the default values...","You know what you should do?","Use your own!","Have a great day!"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,smartBackspace:!0,shuffle:!1,backDelay:700,fadeOut:!1,fadeOutClass:"typed-fade-out",fadeOutDelay:500,loop:!1,loopCount:1/0,showCursor:!0,cursorChar:"|",autoInsertCss:!0,attr:null,bindInputFocusEvents:!1,contentType:"html",onBegin:function(e){},onComplete:function(e){},preStringTyped:function(e,t){},onStringTyped:function(e,t){},onLastStringBackspaced:function(e){},onTypingPaused:function(e,t){},onTypingResumed:function(e,t){},onReset:function(e){},onStop:function(e,t){},onStart:function(e,t){},onDestroy:function(e){}},e=new(function(){function e(){}var t=e.prototype;return t.load=function(e,t,r){if(e.el="string"==typeof r?document.querySelector(r):r,e.options=typed_module_t({},typed_module_s,t),e.isInput="input"===e.el.tagName.toLowerCase(),e.attr=e.options.attr,e.bindInputFocusEvents=e.options.bindInputFocusEvents,e.showCursor=!e.isInput&&e.options.showCursor,e.cursorChar=e.options.cursorChar,e.cursorBlinking=!0,e.elContent=e.attr?e.el.getAttribute(e.attr):e.el.textContent,e.contentType=e.options.contentType,e.typeSpeed=e.options.typeSpeed,e.startDelay=e.options.startDelay,e.backSpeed=e.options.backSpeed,e.smartBackspace=e.options.smartBackspace,e.backDelay=e.options.backDelay,e.fadeOut=e.options.fadeOut,e.fadeOutClass=e.options.fadeOutClass,e.fadeOutDelay=e.options.fadeOutDelay,e.isPaused=!1,e.strings=e.options.strings.map((function(e){return e.trim()})),e.stringsElement="string"==typeof e.options.stringsElement?document.querySelector(e.options.stringsElement):e.options.stringsElement,e.stringsElement){e.strings=[],e.stringsElement.style.cssText="clip: rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px;";var n=Array.prototype.slice.apply(e.stringsElement.children),a=n.length;if(a)for(var o=0;o<a;o+=1)e.strings.push(n[o].innerHTML.trim())}for(var i in e.strPos=0,e.currentElContent=this.getCurrentElContent(e),e.currentElContent&&e.currentElContent.length>0&&(e.strPos=e.currentElContent.length-1,e.strings.unshift(e.currentElContent)),e.sequence=[],e.strings)e.sequence[i]=i;e.arrayPos=0,e.stopNum=0,e.loop=e.options.loop,e.loopCount=e.options.loopCount,e.curLoop=0,e.shuffle=e.options.shuffle,e.pause={status:!1,typewrite:!0,curString:"",curStrPos:0},e.typingComplete=!1,e.autoInsertCss=e.options.autoInsertCss,e.autoInsertCss&&(this.appendCursorAnimationCss(e),this.appendFadeOutAnimationCss(e))},t.getCurrentElContent=function(e){return e.attr?e.el.getAttribute(e.attr):e.isInput?e.el.value:"html"===e.contentType?e.el.innerHTML:e.el.textContent},t.appendCursorAnimationCss=function(e){var t="data-typed-js-cursor-css";if(e.showCursor&&!document.querySelector("["+t+"]")){var r=document.createElement("style");r.setAttribute(t,"true"),r.innerHTML="\n        .typed-cursor{\n          opacity: 1;\n        }\n        .typed-cursor.typed-cursor--blink{\n          animation: typedjsBlink 0.7s infinite;\n          -webkit-animation: typedjsBlink 0.7s infinite;\n                  animation: typedjsBlink 0.7s infinite;\n        }\n        @keyframes typedjsBlink{\n          50% { opacity: 0.0; }\n        }\n        @-webkit-keyframes typedjsBlink{\n          0% { opacity: 1; }\n          50% { opacity: 0.0; }\n          100% { opacity: 1; }\n        }\n      ",document.body.appendChild(r)}},t.appendFadeOutAnimationCss=function(e){var t="data-typed-fadeout-js-css";if(e.fadeOut&&!document.querySelector("["+t+"]")){var r=document.createElement("style");r.setAttribute(t,"true"),r.innerHTML="\n        .typed-fade-out{\n          opacity: 0;\n          transition: opacity .25s;\n        }\n        .typed-cursor.typed-cursor--blink.typed-fade-out{\n          -webkit-animation: 0;\n          animation: 0;\n        }\n      ",document.body.appendChild(r)}},e}()),typed_module_n=new(function(){function e(){}var t=e.prototype;return t.typeHtmlChars=function(e,t,r){if("html"!==r.contentType)return t;var n=e.substring(t).charAt(0);if("<"===n||"&"===n){var a;for(a="<"===n?">":";";e.substring(t+1).charAt(0)!==a&&!(1+ ++t>e.length););t++}return t},t.backSpaceHtmlChars=function(e,t,r){if("html"!==r.contentType)return t;var n=e.substring(t).charAt(0);if(">"===n||";"===n){var a;for(a=">"===n?"<":"&";e.substring(t-1).charAt(0)!==a&&!(--t<0););t--}return t},e}()),typed_module_i=function(){function t(t,r){e.load(this,r,t),this.begin()}var r=t.prototype;return r.toggle=function(){this.pause.status?this.start():this.stop()},r.stop=function(){this.typingComplete||this.pause.status||(this.toggleBlinking(!0),this.pause.status=!0,this.options.onStop(this.arrayPos,this))},r.start=function(){this.typingComplete||this.pause.status&&(this.pause.status=!1,this.pause.typewrite?this.typewrite(this.pause.curString,this.pause.curStrPos):this.backspace(this.pause.curString,this.pause.curStrPos),this.options.onStart(this.arrayPos,this))},r.destroy=function(){this.reset(!1),this.options.onDestroy(this)},r.reset=function(e){void 0===e&&(e=!0),clearInterval(this.timeout),this.replaceText(""),this.cursor&&this.cursor.parentNode&&(this.cursor.parentNode.removeChild(this.cursor),this.cursor=null),this.strPos=0,this.arrayPos=0,this.curLoop=0,e&&(this.insertCursor(),this.options.onReset(this),this.begin())},r.begin=function(){var e=this;this.options.onBegin(this),this.typingComplete=!1,this.shuffleStringsIfNeeded(this),this.insertCursor(),this.bindInputFocusEvents&&this.bindFocusEvents(),this.timeout=setTimeout((function(){0===e.strPos?e.typewrite(e.strings[e.sequence[e.arrayPos]],e.strPos):e.backspace(e.strings[e.sequence[e.arrayPos]],e.strPos)}),this.startDelay)},r.typewrite=function(e,t){var r=this;this.fadeOut&&this.el.classList.contains(this.fadeOutClass)&&(this.el.classList.remove(this.fadeOutClass),this.cursor&&this.cursor.classList.remove(this.fadeOutClass));var n=this.humanizer(this.typeSpeed),a=1;!0!==this.pause.status?this.timeout=setTimeout((function(){t=typed_module_n.typeHtmlChars(e,t,r);var n=0,o=e.substring(t);if("^"===o.charAt(0)&&/^\^\d+/.test(o)){var i=1;i+=(o=/\d+/.exec(o)[0]).length,n=parseInt(o),r.temporaryPause=!0,r.options.onTypingPaused(r.arrayPos,r),e=e.substring(0,t)+e.substring(t+i),r.toggleBlinking(!0)}if("`"===o.charAt(0)){for(;"`"!==e.substring(t+a).charAt(0)&&(a++,!(t+a>e.length)););var s=e.substring(0,t),c=e.substring(s.length+1,t+a),u=e.substring(t+a+1);e=s+c+u,a--}r.timeout=setTimeout((function(){r.toggleBlinking(!1),t>=e.length?r.doneTyping(e,t):r.keepTyping(e,t,a),r.temporaryPause&&(r.temporaryPause=!1,r.options.onTypingResumed(r.arrayPos,r))}),n)}),n):this.setPauseStatus(e,t,!0)},r.keepTyping=function(e,t,r){0===t&&(this.toggleBlinking(!1),this.options.preStringTyped(this.arrayPos,this));var n=e.substring(0,t+=r);this.replaceText(n),this.typewrite(e,t)},r.doneTyping=function(e,t){var r=this;this.options.onStringTyped(this.arrayPos,this),this.toggleBlinking(!0),this.arrayPos===this.strings.length-1&&(this.complete(),!1===this.loop||this.curLoop===this.loopCount)||(this.timeout=setTimeout((function(){r.backspace(e,t)}),this.backDelay))},r.backspace=function(e,t){var r=this;if(!0!==this.pause.status){if(this.fadeOut)return this.initFadeOut();this.toggleBlinking(!1);var n=this.humanizer(this.backSpeed);this.timeout=setTimeout((function(){t=typed_module_n.backSpaceHtmlChars(e,t,r);var n=e.substring(0,t);if(r.replaceText(n),r.smartBackspace){var a=r.strings[r.arrayPos+1];r.stopNum=a&&n===a.substring(0,t)?t:0}t>r.stopNum?(t--,r.backspace(e,t)):t<=r.stopNum&&(r.arrayPos++,r.arrayPos===r.strings.length?(r.arrayPos=0,r.options.onLastStringBackspaced(),r.shuffleStringsIfNeeded(),r.begin()):r.typewrite(r.strings[r.sequence[r.arrayPos]],t))}),n)}else this.setPauseStatus(e,t,!1)},r.complete=function(){this.options.onComplete(this),this.loop?this.curLoop++:this.typingComplete=!0},r.setPauseStatus=function(e,t,r){this.pause.typewrite=r,this.pause.curString=e,this.pause.curStrPos=t},r.toggleBlinking=function(e){this.cursor&&(this.pause.status||this.cursorBlinking!==e&&(this.cursorBlinking=e,e?this.cursor.classList.add("typed-cursor--blink"):this.cursor.classList.remove("typed-cursor--blink")))},r.humanizer=function(e){return Math.round(Math.random()*e/2)+e},r.shuffleStringsIfNeeded=function(){this.shuffle&&(this.sequence=this.sequence.sort((function(){return Math.random()-.5})))},r.initFadeOut=function(){var e=this;return this.el.className+=" "+this.fadeOutClass,this.cursor&&(this.cursor.className+=" "+this.fadeOutClass),setTimeout((function(){e.arrayPos++,e.replaceText(""),e.strings.length>e.arrayPos?e.typewrite(e.strings[e.sequence[e.arrayPos]],0):(e.typewrite(e.strings[0],0),e.arrayPos=0)}),this.fadeOutDelay)},r.replaceText=function(e){this.attr?this.el.setAttribute(this.attr,e):this.isInput?this.el.value=e:"html"===this.contentType?this.el.innerHTML=e:this.el.textContent=e},r.bindFocusEvents=function(){var e=this;this.isInput&&(this.el.addEventListener("focus",(function(t){e.stop()})),this.el.addEventListener("blur",(function(t){e.el.value&&0!==e.el.value.length||e.start()})))},r.insertCursor=function(){this.showCursor&&(this.cursor||(this.cursor=document.createElement("span"),this.cursor.className="typed-cursor",this.cursor.setAttribute("aria-hidden",!0),this.cursor.innerHTML=this.cursorChar,this.el.parentNode&&this.el.parentNode.insertBefore(this.cursor,this.el.nextSibling)))},t}();function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var BouncingDots=function(e){var t={width:9,height:9,margin:"5px 0px 0px 5px",borderRadius:"50%",backgroundColor:"#a3a1a1",opacity:1,animation:"bouncing-loader 0.4s infinite alternate"};return React.createElement(React.Fragment,null,React.createElement("style",null,"\n          @keyframes bouncing-loader {\n            to {\n              opacity: 0.6;\n              transform: translateY(-10px);\n            }\n          }\n        "),React.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:26}},["0.1s","0.2s","0.3s"].map((function(e,r){return React.createElement("div",{key:r,style:_objectSpread(_objectSpread({},t),{},{animationDelay:e})})}))))},js_helpers=__webpack_require__(678),chatbot_MwaiAPI=__webpack_require__(137),_excluded=["enabled","content","children","className"];function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_extends.apply(this,arguments)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,a=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}var _wp$element=wp.element,useState=_wp$element.useState,useEffect=_wp$element.useEffect,useRef=_wp$element.useRef,useCallback=_wp$element.useCallback,svgPathDefault='<path d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" />',svgPathSuccess='<path d="M10.7673 18C10.3106 18 9.86749 17.8046 9.54432 17.4555L5.50694 13.1222C4.83102 12.3968 4.83102 11.2208 5.50694 10.4954C6.18287 9.76997 7.27871 9.76997 7.95505 10.4954L10.6794 13.4196L16.9621 5.63976C17.5874 4.86495 18.6832 4.78289 19.4031 5.45388C20.125 6.12487 20.2036 7.29638 19.5759 8.07391L12.0778 17.3589C11.7639 17.7475 11.3119 17.9801 10.8319 18C10.8087 18 10.788 18 10.7673 18Z" />',svgPathError='<path d="M17.7623 17.7626C17.0831 18.4418 15.9549 18.416 15.244 17.705L5.79906 8.26012C5.08811 7.54917 5.0623 6.42098 5.74145 5.74183C6.4206 5.06267 7.54879 5.08849 8.25975 5.79944L17.7047 15.2443C18.4156 15.9553 18.4414 17.0835 17.7623 17.7626Z" /><path d="M17.5508 8.52848L8.52842 17.5509C7.84927 18.23 6.72108 18.2042 6.01012 17.4933C5.29917 16.7823 5.27336 15.6541 5.95251 14.975L14.9749 5.95257C15.6541 5.27342 16.7823 5.29923 17.4932 6.01019C18.2042 6.72114 18.23 7.84933 17.5508 8.52848Z" />',ReplyActions=function(e){var t=e.enabled,r=e.content,n=e.children,a=e.className,o=_objectWithoutProperties(e,_excluded),i=(0,helpers.gR)(),s=_slicedToArray(useState("idle"),2),c=s[0],u=s[1],l=_slicedToArray(useState(!0),2),p=l[0],d=l[1],f=useRef(null),h=useRef(!1),m=useCallback((function(){h.current||(h.current=!0,f.current=setTimeout((function(){d(!1)}),500))}),[]),y=useCallback((function(){f.current&&clearTimeout(f.current),d(!0),h.current=!1}),[]);useEffect((function(){return function(){f.current&&clearTimeout(f.current)}}),[]);var _="success"===c?svgPathSuccess:"error"===c?svgPathError:svgPathDefault;return React.createElement("div",_extends({},o,{onMouseLeave:y,onMouseEnter:m,onMouseOver:m}),React.createElement("span",{className:a},n),React.createElement("div",{className:i("mwai-reply-actions",{"mwai-hidden":p})},t&&React.createElement("div",{className:"mwai-copy-button",onClick:function(){try{navigator.clipboard.writeText(r),u("success")}catch(e){u("error"),console.warn("Not allowed to copy to clipboard. Make sure your website uses HTTPS.",{content:r})}finally{setTimeout((function(){u("idle")}),2e3)}}},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",dangerouslySetInnerHTML:{__html:_}}))))};const components_ReplyActions=ReplyActions;function ChatbotName_slicedToArray(e,t){return ChatbotName_arrayWithHoles(e)||ChatbotName_iterableToArrayLimit(e,t)||ChatbotName_unsupportedIterableToArray(e,t)||ChatbotName_nonIterableRest()}function ChatbotName_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatbotName_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return ChatbotName_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ChatbotName_arrayLikeToArray(e,t):void 0}}function ChatbotName_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ChatbotName_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function ChatbotName_arrayWithHoles(e){if(Array.isArray(e))return e}var useMemo=wp.element.useMemo,ChatbotName=function(e){var t=e.role,r=void 0===t?"user":t,n=(0,ChatbotContext.o)().state,a=n.pluginUrl,o=n.iconUrl,i=n.userData,s=n.userName,c=n.aiName,u=n.guestName,l=n.userAvatar,p=n.aiAvatar,d=n.guestAvatar,f=n.userAvatarUrl,h=n.aiAvatarUrl,m=n.guestAvatarUrl,y=useMemo((function(){var e="assistant"===r,t=!i&&!e,n=function(e){return React.createElement("div",{className:"mwai-name-text"},e)},y=function(e,t,r,n){var o,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!e)return null;if((0,js_helpers.Ve)(t))return o=t,React.createElement("div",{className:"mwai-avatar mwai-emoji",style:{fontSize:"32px",lineHeight:"32px"}},o);var s=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,helpers.mv)(e)?e:e&&!(0,js_helpers.Ve)(e)?t?e:"".concat(a,"/images/").concat(e):(t||(0,js_helpers.Ve)(e)||console.warn("Invalid URL for avatar:",e),null)}(t,i)||r;return s?function(e,t){return React.createElement("div",{className:"mwai-avatar"},React.createElement("img",{width:"32",height:"32",src:e,alt:t}))}(s,n):null};if(e){var _=y(p,h,o,"AI Avatar");return _?(null===h&&o&&console.warn("Using iconUrl as a temporary fallback for AI avatar. Please set aiAvatarUrl."),_):n(c)}return t?t?y(d,m,null,"Guest Avatar")||n(u||"Guest"):void 0:y(l,f,null==i?void 0:i.AVATAR_URL,"User Avatar",!0)||n(formatName(s,u,i))}),[r,c,s,u,i,o,p,l,d,h,f,m,a]);return React.createElement("span",{className:"mwai-name"},y)};function formatName(e,t,r){return r&&0!==Object.keys(r).length?Object.entries(r).reduce((function(e,t){var r=ChatbotName_slicedToArray(t,2),n=r[0],a=r[1],o="{".concat(n,"}");return e.includes(o)?e.replace(o,a):e}),e):t||e||"Guest"}const chatbot_ChatbotName=ChatbotName;function ChatbotReply_slicedToArray(e,t){return ChatbotReply_arrayWithHoles(e)||ChatbotReply_iterableToArrayLimit(e,t)||ChatbotReply_unsupportedIterableToArray(e,t)||ChatbotReply_nonIterableRest()}function ChatbotReply_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatbotReply_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return ChatbotReply_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ChatbotReply_arrayLikeToArray(e,t):void 0}}function ChatbotReply_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ChatbotReply_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function ChatbotReply_arrayWithHoles(e){if(Array.isArray(e))return e}var ChatbotReply_wp$element=wp.element,ChatbotReply_useState=ChatbotReply_wp$element.useState,ChatbotReply_useMemo=ChatbotReply_wp$element.useMemo,ChatbotReply_useEffect=ChatbotReply_wp$element.useEffect,ChatbotReply_useRef=ChatbotReply_wp$element.useRef,LinkContainer=function(e){var t=e.href,r=e.children;if(!t)return React.createElement("span",null,r);window.location.hostname;var n="_blank";try{new URL(t,window.location.href).hostname}catch(e){console.error("Invalid URL:",e)}if("Uploaded File"===String(r)){var a=t.split("/").pop();return React.createElement("a",{href:t,target:n,rel:"noopener noreferrer",className:"mwai-filename"},React.createElement("span",null," ",a))}return React.createElement("a",{href:t,target:n,rel:"noopener noreferrer"},r)},RawMessage=function(e){var t,r=e.message,n=e.onRendered,a=void 0===n?function(){}:n,o=(0,ChatbotContext.o)().state.copyButton,i=ChatbotReply_slicedToArray(ChatbotReply_useState(r.isQuerying||r.isStreaming),1)[0],s=r.isQuerying,c=r.isStreaming,u=null!==(t=r.content)&&void 0!==t?t:"";(u.match(/```/g)||[]).length%2!=0?u+="\n```":r.isStreaming&&(u+="<BlinkingCursor />"),ChatbotReply_useEffect((function(){i&&(!i||s||c)||a()}),[i,s,c]);var l=ChatbotReply_useMemo((function(){var e={overrides:{BlinkingCursor:{component:js_helpers.rn},a:{component:LinkContainer},img:{props:{onError:function(e){null!==e.target.src.match(/\.(jpeg|jpg|gif|png)$/)&&(e.target.src="https://placehold.co/600x200?text=Expired+Image")},className:"mwai-image"}}}};return e}),[]),p=ChatbotReply_useMemo((function(){var e="";try{e=Ze(u,l)}catch(t){console.error("Crash in markdown-to-jsx! Reverting to plain text.",{e:t,content:u}),e=u}return e}),[u,l]);return s||c&&!u?React.createElement(BouncingDots,null):React.createElement(React.Fragment,null,React.createElement(chatbot_ChatbotName,{role:r.role}),React.createElement(components_ReplyActions,{content:r.content,enabled:o,className:"mwai-text"},p))},ImagesMessage=function(e){var t=e.message,r=e.onRendered,n=void 0===r?function(){}:r,a=ChatbotReply_slicedToArray(ChatbotReply_useState(null==t?void 0:t.images),2),o=a[0],i=a[1];return ChatbotReply_useEffect((function(){n()})),t.isQuerying?React.createElement(BouncingDots,null):React.createElement(React.Fragment,null,React.createElement(chatbot_ChatbotName,{role:t.role}),React.createElement("span",{className:"mwai-text"},React.createElement("div",{className:"mwai-gallery"},null==o?void 0:o.map((function(e,t){return React.createElement("a",{key:t,href:e,target:"_blank",rel:"noopener noreferrer"},React.createElement("img",{key:t,src:e,onError:function(){return function(e){i((function(t){return t.map((function(t,r){return r===e?"https://placehold.co/600x200?text=Expired+Image":t}))}))}(t)}}))})))))},TypedMessage=function(e){var t=e.message,r=e.conversationRef,n=e.onRendered,a=void 0===n?function(){}:n,o=ChatbotReply_useRef(null),i=ChatbotReply_slicedToArray(ChatbotReply_useState(t.isQuerying),1)[0],s=ChatbotReply_slicedToArray(ChatbotReply_useState(!t.isQuerying),2),c=s[0],u=s[1],l=t.content;ChatbotReply_useEffect((function(){console.warn("Do not use the Typewriter Effect. Use Streaming instead.")}),[]),(0,helpers.$$)(200,(function(){null!=r&&r.current}),!c),ChatbotReply_useEffect((function(){if(i){if(o.current){var e={strings:[l],typeSpeed:(0,chatbot_MwaiAPI.W5)("typewriter.speed",15),showCursor:!1,onComplete:function(e){e.cursor&&e.cursor.remove(),a(),u((function(){return!0}))}},t=new typed_module_i(o.current,e);return function(){t.destroy()}}}else a()}),[t,t.isQuerying]);var p=ChatbotReply_useMemo((function(){var e="";try{e=Ze(l)}catch(t){console.error("Crash in markdown-to-jsx! Reverting to plain text.",{e:t,content:l}),e=l}return e}),[l]);return React.createElement(React.Fragment,null,t.isQuerying&&React.createElement(BouncingDots,null),!t.isQuerying&&i&&React.createElement(React.Fragment,null,React.createElement(chatbot_ChatbotName,{role:t.role}),React.createElement("span",{className:"mwai-text",ref:o})),!t.isQuerying&&!i&&React.createElement(React.Fragment,null,React.createElement(chatbot_ChatbotName,{role:t.role}),React.createElement("span",{className:"mwai-text"},p)))},ChatbotReply=function(e){var t,r=e.message,n=e.conversationRef,a=(0,ChatbotContext.o)().state.typewriter,o=(0,helpers.gR)(),i=ChatbotReply_useRef(),s=o("mwai-reply",{"mwai-ai":"assistant"===r.role,"mwai-user":"user"===r.role,"mwai-system":"system"===r.role}),c=(null==r||null===(t=r.images)||void 0===t?void 0:t.length)>0,u=function(){i.current&&(r.isQuerying||i.current.classList.contains("mwai-rendered")||"undefined"!=typeof hljs&&(i.current.classList.add("mwai-rendered"),i.current.querySelectorAll("pre code").forEach((function(e){hljs.highlightElement(e)}))))};return ChatbotReply_useMemo((function(){return"user"===r.role?React.createElement("div",{ref:i,className:s},React.createElement(RawMessage,{message:r})):"assistant"===r.role?c?React.createElement("div",{ref:i,className:s},React.createElement(ImagesMessage,{message:r,conversationRef:n,onRendered:u})):a&&!r.isStreaming?(console.warn("The Typewriter effect is deprecated. Use Streaming instead."),React.createElement("div",{ref:i,className:s},React.createElement(TypedMessage,{message:r,conversationRef:n,onRendered:u}))):React.createElement("div",{ref:i,className:s},React.createElement(RawMessage,{message:r,conversationRef:n,onRendered:u})):"system"===r.role?React.createElement("div",{ref:i,className:s},React.createElement(RawMessage,{message:r,conversationRef:n,onRendered:u})):React.createElement("div",null,React.createElement("i",null,"Unhandled role."))}),[r,n,c,a])};const chatbot_ChatbotReply=ChatbotReply;function extends_extends(){return extends_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},extends_extends.apply(this,arguments)}function objectWithoutPropertiesLoose_objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}var index=external_React_.useLayoutEffect;const use_isomorphic_layout_effect_browser_esm=index;var useLatest=function(e){var t=external_React_.useRef(e);return use_isomorphic_layout_effect_browser_esm((function(){t.current=e})),t},updateRef=function(e,t){"function"!=typeof e?e.current=t:e(t)},useComposedRef=function(e,t){var r=(0,external_React_.useRef)();return(0,external_React_.useCallback)((function(n){e.current=n,r.current&&updateRef(r.current,null),r.current=t,t&&updateRef(t,n)}),[t])};const use_composed_ref_esm=useComposedRef;var HIDDEN_TEXTAREA_STYLE={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},forceHiddenStyles=function(e){Object.keys(HIDDEN_TEXTAREA_STYLE).forEach((function(t){e.style.setProperty(t,HIDDEN_TEXTAREA_STYLE[t],"important")}))},forceHiddenStyles$1=forceHiddenStyles,hiddenTextarea=null,getHeight=function(e,t){var r=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?r+t.borderSize:r-t.paddingSize};function calculateNodeHeight(e,t,r,n){void 0===r&&(r=1),void 0===n&&(n=1/0),hiddenTextarea||((hiddenTextarea=document.createElement("textarea")).setAttribute("tabindex","-1"),hiddenTextarea.setAttribute("aria-hidden","true"),forceHiddenStyles$1(hiddenTextarea)),null===hiddenTextarea.parentNode&&document.body.appendChild(hiddenTextarea);var a=e.paddingSize,o=e.borderSize,i=e.sizingStyle,s=i.boxSizing;Object.keys(i).forEach((function(e){var t=e;hiddenTextarea.style[t]=i[t]})),forceHiddenStyles$1(hiddenTextarea),hiddenTextarea.value=t;var c=getHeight(hiddenTextarea,e);hiddenTextarea.value=t,c=getHeight(hiddenTextarea,e),hiddenTextarea.value="x";var u=hiddenTextarea.scrollHeight-a,l=u*r;"border-box"===s&&(l=l+a+o),c=Math.max(l,c);var p=u*n;return"border-box"===s&&(p=p+a+o),[c=Math.min(p,c),u]}var noop=function(){},pick=function(e,t){return e.reduce((function(e,r){return e[r]=t[r],e}),{})},SIZING_STYLE=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],isIE=!!document.documentElement.currentStyle,getSizingData=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var r=pick(SIZING_STYLE,t),n=r.boxSizing;return""===n?null:(isIE&&"border-box"===n&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})},getSizingData$1=getSizingData;function useListener(e,t,r){var n=useLatest(r);external_React_.useLayoutEffect((function(){var r=function(e){return n.current(e)};if(e)return e.addEventListener(t,r),function(){return e.removeEventListener(t,r)}}),[])}var useWindowResizeListener=function(e){useListener(window,"resize",e)},useFontsLoadedListener=function(e){useListener(document.fonts,"loadingdone",e)},react_textarea_autosize_browser_esm_excluded=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],TextareaAutosize=function(e,t){var r=e.cacheMeasurements,n=e.maxRows,a=e.minRows,o=e.onChange,i=void 0===o?noop:o,s=e.onHeightChange,c=void 0===s?noop:s,u=objectWithoutPropertiesLoose_objectWithoutPropertiesLoose(e,react_textarea_autosize_browser_esm_excluded),l=void 0!==u.value,p=external_React_.useRef(null),d=use_composed_ref_esm(p,t),f=external_React_.useRef(0),h=external_React_.useRef(),m=function(){var e=p.current,t=r&&h.current?h.current:getSizingData$1(e);if(t){h.current=t;var o=calculateNodeHeight(t,e.value||e.placeholder||"x",a,n),i=o[0],s=o[1];f.current!==i&&(f.current=i,e.style.setProperty("height",i+"px","important"),c(i,{rowHeight:s}))}};return external_React_.useLayoutEffect(m),useWindowResizeListener(m),useFontsLoadedListener(m),external_React_.createElement("textarea",extends_extends({},u,{onChange:function(e){l||m(),i(e)},ref:d}))},react_textarea_autosize_browser_esm_index=external_React_.forwardRef(TextareaAutosize);function ChatUploadIcon_slicedToArray(e,t){return ChatUploadIcon_arrayWithHoles(e)||ChatUploadIcon_iterableToArrayLimit(e,t)||ChatUploadIcon_unsupportedIterableToArray(e,t)||ChatUploadIcon_nonIterableRest()}function ChatUploadIcon_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatUploadIcon_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return ChatUploadIcon_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ChatUploadIcon_arrayLikeToArray(e,t):void 0}}function ChatUploadIcon_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ChatUploadIcon_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function ChatUploadIcon_arrayWithHoles(e){if(Array.isArray(e))return e}var ChatUploadIcon_wp$element=wp.element,ChatUploadIcon_useState=ChatUploadIcon_wp$element.useState,ChatUploadIcon_useMemo=ChatUploadIcon_wp$element.useMemo,ChatUploadIcon_useRef=ChatUploadIcon_wp$element.useRef,ChatUploadIcon=function(){var e=(0,helpers.gR)(),t=(0,ChatbotContext.o)(),r=t.state,n=t.actions,a=r.uploadedFile,o=r.busy,i=r.imageUpload,s=r.fileUpload,c=r.fileSearch,u=r.draggingType,l=n.onUploadFile,p=ChatUploadIcon_slicedToArray(ChatUploadIcon_useState(!1),2),d=p[0],f=p[1],h=ChatUploadIcon_useRef(),m=null==a?void 0:a.uploadedId,y=i||c||s,_=a,b=ChatUploadIcon_useMemo((function(){return null!=_&&_.localFile?_.localFile.type.startsWith("image/")?"image":"document":u}),[_,u]),v=ChatUploadIcon_useMemo((function(){var e="idle";null!=_&&_.uploadProgress?e="up":u?e="add":d&&m?e="del":m?e="ok":d&&!m&&(e="add");var t=b?b.toLowerCase():"idle";return"mwai-file-upload-icon mwai-".concat(t,"-").concat(e)}),[b,_,u,d,m]),g=ChatUploadIcon_useMemo((function(){return null!=_&&_.uploadProgress?_.uploadProgress>99?99:Math.round(_.uploadProgress):""}),[_]);return y?React.createElement("div",{disabled:o,onClick:function(){null!=a&&a.localFile?l(null):o||h.current.click()},onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)},className:e("mwai-file-upload",{"mwai-enabled":null==a?void 0:a.uploadedId,"mwai-busy":(null==a?void 0:a.localFile)&&!(null!=a&&a.uploadedId)}),style:{cursor:o?"default":"pointer"}},React.createElement("div",{className:v},React.createElement("span",{className:"mwai-file-upload-progress"},g)),React.createElement("input",{type:"file",ref:h,onChange:function(e){var t=e.target.files[0];t&&l(t)},style:{display:"none"}})):null};const chatbot_ChatUploadIcon=ChatUploadIcon;function ChatbotInput_slicedToArray(e,t){return ChatbotInput_arrayWithHoles(e)||ChatbotInput_iterableToArrayLimit(e,t)||ChatbotInput_unsupportedIterableToArray(e,t)||ChatbotInput_nonIterableRest()}function ChatbotInput_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatbotInput_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return ChatbotInput_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ChatbotInput_arrayLikeToArray(e,t):void 0}}function ChatbotInput_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ChatbotInput_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function ChatbotInput_arrayWithHoles(e){if(Array.isArray(e))return e}var ChatbotInput_wp$element=wp.element,ChatbotInput_useRef=ChatbotInput_wp$element.useRef,ChatbotInput_useState=ChatbotInput_wp$element.useState,ChatbotInput_useEffect=ChatbotInput_wp$element.useEffect,useImperativeHandle=ChatbotInput_wp$element.useImperativeHandle,ChatbotInput=function(){var e=(0,helpers.gR)(),t=(0,ChatbotContext.o)(),r=t.state,n=t.actions,a=r.inputText,o=r.textInputMaxLength,i=r.textInputPlaceholder,s=r.error,c=r.speechRecognitionAvailable,u=r.isMobile,l=r.conversationRef,p=r.open,d=r.uploadIconPosition,f=r.locked,h=r.isListening,m=r.busy,y=r.speechRecognition,_=r.chatbotInputRef,b=n.onSubmitAction,v=n.setIsListening,g=n.resetError,w=n.setInputText,x=ChatbotInput_slicedToArray(ChatbotInput_useState(!1),2),C=x[0],S=x[1],R=ChatbotInput_useRef();useImperativeHandle(_,(function(){return{focusInput:function(){var e;null===(e=R.current)||void 0===e||e.focus()},currentElement:function(){return R.current}}})),ChatbotInput_useEffect((function(){!u&&p&&R.current.focus(),l.current&&(l.current.scrollTop=l.current.scrollHeight)}),[p,u,l]);var E=e("mwai-input-text",{});return React.createElement("div",{ref:_,className:E},"mwai-input"===d&&React.createElement(chatbot_ChatUploadIcon,null),React.createElement(react_textarea_autosize_browser_esm_index,{ref:R,disabled:m||f,placeholder:i,value:a,maxLength:o,onCompositionStart:function(){return S(!0)},onCompositionEnd:function(){return S(!1)},onKeyDown:function(e){C||"Enter"!==e.code||e.shiftKey||(e.preventDefault(),b())},onChange:function(e){return t=e.target.value,h&&v(!1),s&&g(),void w(t);var t}}),y&&React.createElement(helpers.tm,{active:h,disabled:!c||m,className:"mwai-microphone",onClick:function(){return v(!h)}}))};const chatbot_ChatbotInput=ChatbotInput;var createLucideIcon=__webpack_require__(407);const Send=(0,createLucideIcon.A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Eraser=(0,createLucideIcon.A)("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);var ChatbotSubmit_wp$element=wp.element,ChatbotSubmit_useMemo=ChatbotSubmit_wp$element.useMemo,ChatbotSubmit_useCallback=ChatbotSubmit_wp$element.useCallback,ChatbotSubmit=function(){var e=(0,ChatbotContext.o)(),t=e.state,r=e.actions,n=r.onClear,a=r.onSubmitAction,o=r.setIsListening,i=t.textClear,s=t.textSend,c=t.uploadedFile,u=t.inputText,l=t.messages,p=t.isListening,d=t.timeElapsed,f=t.busy,h=t.submitButtonConf,m=t.locked,y=!(null==c||!c.uploadProgress),_=!(null!=c&&c.uploadedId)&&u.length<1&&(null==l?void 0:l.length)>1,b=ChatbotSubmit_useMemo((function(){return f?d?React.createElement("div",{className:"mwai-timer"},d):null:null!=h&&h.imageSend&&null!=h&&h.imageClear?React.createElement("img",{src:_?h.imageClear:h.imageSend,alt:_?i:s}):_||s?_&&!i?React.createElement(Eraser,{size:"20"}):React.createElement("span",null,_?i:s):React.createElement(Send,{size:"20",style:{marginLeft:10}})}),[f,d,_,i,s,h]),v=ChatbotSubmit_useMemo((function(){return"mwai-input-submit ".concat(f?"mwai-busy":"")}),[f]),g=ChatbotSubmit_useCallback((function(){p&&o(!1),_?n():a()}),[_,p,n,a,o]),w=ChatbotSubmit_useCallback((function(){f||g()}),[f,g]);return React.createElement("button",{className:v,disabled:f||y||m,onClick:w},b)};const chatbot_ChatbotSubmit=ChatbotSubmit;var ChatbotHeader_useMemo=wp.element.useMemo;function formatAvatar(e,t,r,n){var a;if((0,js_helpers.Ve)(n||r))return a=n||r,React.createElement("div",{className:"mwai-avatar mwai-emoji",style:{fontSize:"48px",lineHeight:"48px"}},a);var o,i,s=(o=n,((0,helpers.mv)(o)?o:o?"".concat(t,"/images/").concat(o):null)||r||"".concat(t,"/images/chat-openai.svg"));return s?(i=s,"AI Engine",React.createElement("div",{className:"mwai-avatar"},React.createElement("img",{alt:"AI Engine",src:i}))):React.createElement("div",{className:"mwai-name-text"},e)}var ChatbotHeader=function(){var e=(0,ChatbotContext.o)(),t=e.state,r=e.actions,n=t.theme,a=t.isWindow,o=t.fullscreen,i=t.aiName,s=t.pluginUrl,c=t.open,u=t.iconUrl,l=t.aiAvatarUrl,p=t.windowed,d=t.headerSubtitle,f=r.setOpen,h=r.setWindowed,m=ChatbotHeader_useMemo((function(){if(!a)return null;var e="timeless"===(null==n?void 0:n.themeId),t=e?formatAvatar(i,s,u,l):null,r=null==d?"Discuss with":d;return React.createElement(React.Fragment,null,e&&React.createElement(React.Fragment,null,t,React.createElement("div",{className:"mwai-name"},r&&React.createElement("small",{className:"mwai-subtitle"},r),React.createElement("div",null,i)),React.createElement("div",{style:{flex:"auto"}})),React.createElement("div",{className:"mwai-buttons"},o&&React.createElement("div",{className:"mwai-resize-button",onClick:function(){return h(!p)}}),React.createElement("div",{className:"mwai-close-button",onClick:function(){return f(!c)}})))}),[a,null==n?void 0:n.themeId,i,s,u,l,o,h,p,f,c,d]);return React.createElement("div",{className:"mwai-header"},m)};const chatbot_ChatbotHeader=ChatbotHeader;var ChatbotTrigger_wp$element=wp.element,ChatbotTrigger_useMemo=ChatbotTrigger_wp$element.useMemo,ChatbotTrigger_useEffect=ChatbotTrigger_wp$element.useEffect,ChatbotTrigger=function(){var e=(0,ChatbotContext.o)(),t=e.state,r=e.actions,n=t.isWindow,a=t.iconText,o=t.showIconMessage,i=t.iconAlt,s=t.iconUrl,c=t.open,u=r.setShowIconMessage,l=r.setOpen;ChatbotTrigger_useEffect((function(){c&&o&&u(!1)}),[c,u,o]);var p=ChatbotTrigger_useMemo((function(){return n?React.createElement("div",{className:"mwai-trigger mwai-open-button"},React.createElement(helpers.bE,{className:"mwai-icon-text-container",if:a&&o},React.createElement("div",{className:"mwai-icon-text-close",onClick:function(){return u(!1)}},""),React.createElement("div",{className:"mwai-icon-text",onClick:function(){return l(!0)}},a)),React.createElement("div",{className:"mwai-icon-container",onClick:function(){return l(!0)}},(0,js_helpers.Ve)(s)?React.createElement("div",{className:"mwai-icon mwai-emoji",style:{fontSize:"48px",lineHeight:"64px",width:"64px",height:"64px",display:"flex",justifyContent:"center",alignItems:"center"}},s):React.createElement("img",{className:"mwai-icon",width:"64",height:"64",alt:i,src:s}))):null}),[n,a,o,i,s,u,l]);return React.createElement(React.Fragment,null,p)};const chatbot_ChatbotTrigger=ChatbotTrigger,Play=(0,createLucideIcon.A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),Loader=(0,createLucideIcon.A)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),Square=(0,createLucideIcon.A)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Pause=(0,createLucideIcon.A)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),Users=(0,createLucideIcon.A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Captions=(0,createLucideIcon.A)("Captions",[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]]),Bug=(0,createLucideIcon.A)("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);function AudioVisualizer_slicedToArray(e,t){return AudioVisualizer_arrayWithHoles(e)||AudioVisualizer_iterableToArrayLimit(e,t)||AudioVisualizer_unsupportedIterableToArray(e,t)||AudioVisualizer_nonIterableRest()}function AudioVisualizer_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function AudioVisualizer_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return AudioVisualizer_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?AudioVisualizer_arrayLikeToArray(e,t):void 0}}function AudioVisualizer_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function AudioVisualizer_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function AudioVisualizer_arrayWithHoles(e){if(Array.isArray(e))return e}var AudioVisualizer_wp$element=wp.element,AudioVisualizer_useState=AudioVisualizer_wp$element.useState,AudioVisualizer_useRef=AudioVisualizer_wp$element.useRef,AudioVisualizer_useEffect=AudioVisualizer_wp$element.useEffect;function measureVolume(e,t){e.getByteTimeDomainData(t);for(var r=0,n=0;n<t.length;n++){var a=t[n]-128;r+=a*a}return Math.sqrt(r/t.length)}function AudioVisualizerTwoStreams(e){var t=e.assistantStream,r=void 0===t?null:t,n=e.userStream,a=void 0===n?null:n,o=e.assistantColor,i=void 0===o?null:o,s=e.userColor,c=void 0===s?null:s,u=e.userUI,l=void 0===u?{emoji:null,text:null,image:null,use:"text"}:u,p=e.assistantUI,d=void 0===p?{emoji:null,text:null,image:null,use:"text"}:p,f=e.attackSpeed,h=void 0===f?.3:f,m=e.releaseSpeed,y=void 0===m?.05:m,_=e.circleSize,b=void 0===_?50:_,v=e.pulseMaxSize,g=void 0===v?30:v,w=AudioVisualizer_slicedToArray(AudioVisualizer_useState(0),2),x=w[0],C=w[1],S=AudioVisualizer_slicedToArray(AudioVisualizer_useState(0),2),R=S[0],E=S[1],I=AudioVisualizer_useRef(0),k=AudioVisualizer_useRef(0),A=AudioVisualizer_useRef(null),T=AudioVisualizer_useRef(null),O=AudioVisualizer_useRef(null),P=AudioVisualizer_useRef(null),L=AudioVisualizer_useRef(null);AudioVisualizer_useEffect((function(){if(r||a){A.current||(A.current=new AudioContext);var e,t,n,o=A.current;return r&&(e=o.createMediaStreamSource(r),T.current=o.createAnalyser(),T.current.fftSize=1024,O.current=new Uint8Array(T.current.frequencyBinCount),e.connect(T.current)),a&&(t=o.createMediaStreamSource(a),P.current=o.createAnalyser(),P.current.fftSize=1024,L.current=new Uint8Array(P.current.frequencyBinCount),t.connect(P.current)),function e(){var t=0;T.current&&O.current&&(t=measureVolume(T.current,O.current));var r=0;P.current&&L.current&&(r=measureVolume(P.current,L.current)),t>I.current?I.current=I.current*(1-h)+t*h:I.current=I.current*(1-y)+t*y,r>k.current?k.current=k.current*(1-h)+r*h:k.current=k.current*(1-y)+r*y,C(I.current),E(k.current),n=requestAnimationFrame(e)}(),function(){e&&e.disconnect(),T.current&&T.current.disconnect(),t&&t.disconnect(),P.current&&P.current.disconnect(),n&&cancelAnimationFrame(n)}}}),[r,a,h,y]);var j=b+Math.min(x/20,1)*g,U=b+Math.min(R/20,1)*g,D=b+g,M={width:U,height:U,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",opacity:.5};c&&(M.backgroundColor=c);var N={width:j,height:j,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",opacity:.5};i&&(N.backgroundColor=i);var B={width:b,height:b,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:"#fff"};c&&(B.backgroundColor=c);var F={width:b,height:b,borderRadius:"50%",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:"#fff"};i&&(F.backgroundColor=i);var z="mwai-visualizer";R>x?z+=" mwai-user-talking":x>R&&(z+=" mwai-assistant-talking");var W=function(e){if(!e)return null;var t=e.emoji,r=e.text,n=e.image;switch(e.use){case"emoji":return t?React.createElement("span",null,t):r?React.createElement("span",null,r.slice(0,1)):null;case"image":return n?React.createElement("img",{src:n,alt:"",style:{width:"100%",height:"100%",borderRadius:"50%"}}):t?React.createElement("span",null,t):r?React.createElement("span",null,r.slice(0,1)):null;default:return r?React.createElement("span",null,r.slice(0,1)):t?React.createElement("span",null,t):null}};return React.createElement("div",{className:z},React.createElement("div",{className:"mwai-visualizer-user",style:{position:"relative",width:D,height:D,overflow:"visible"}},React.createElement("div",{className:"mwai-animation",style:M}),React.createElement("div",{style:B},W(l))),React.createElement("hr",{className:"mwai-visualizer-line"}),React.createElement("div",{className:"mwai-visualizer-assistant",style:{position:"relative",width:D,height:D,overflow:"visible"}},React.createElement("div",{className:"mwai-animation",style:N}),React.createElement("div",{style:F},W(d))))}function ChatbotRealtime_typeof(e){return ChatbotRealtime_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ChatbotRealtime_typeof(e)}function ChatbotRealtime_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ChatbotRealtime_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ChatbotRealtime_ownKeys(Object(r),!0).forEach((function(t){ChatbotRealtime_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ChatbotRealtime_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ChatbotRealtime_defineProperty(e,t,r){return(t=ChatbotRealtime_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ChatbotRealtime_toPropertyKey(e){var t=ChatbotRealtime_toPrimitive(e,"string");return"symbol"==ChatbotRealtime_typeof(t)?t:String(t)}function ChatbotRealtime_toPrimitive(e,t){if("object"!=ChatbotRealtime_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ChatbotRealtime_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||ChatbotRealtime_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return ChatbotRealtime_arrayLikeToArray(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof _?t:_,i=Object.create(o.prototype),s=new T(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",h="executing",m="completed",y={};function _(){}function b(){}function v(){}var g={};u(g,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(O([])));x&&x!==r&&n.call(x,i)&&(g=x);var C=v.prototype=_.prototype=Object.create(g);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(a,o,i,s){var c=p(e[a],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==ChatbotRealtime_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var o;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function E(t,r,n){var a=d;return function(o,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var c=I(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=h;var u=p(t,r,n);if("normal"===u.type){if(a=n.done?m:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=m,n.method="throw",n.arg=u.arg)}}}function I(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,I(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var o=p(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,y;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(ChatbotRealtime_typeof(t)+" is not iterable")}return b.prototype=v,a(C,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:b,configurable:!0}),b.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},S(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new R(l(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(C),u(C,c,"Generator"),u(C,i,(function(){return this})),u(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return s.type="throw",s.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;A(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function asyncGeneratorStep(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){asyncGeneratorStep(o,n,a,i,s,"next",e)}function s(e){asyncGeneratorStep(o,n,a,i,s,"throw",e)}i(void 0)}))}}function ChatbotRealtime_slicedToArray(e,t){return ChatbotRealtime_arrayWithHoles(e)||ChatbotRealtime_iterableToArrayLimit(e,t)||ChatbotRealtime_unsupportedIterableToArray(e,t)||ChatbotRealtime_nonIterableRest()}function ChatbotRealtime_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatbotRealtime_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return ChatbotRealtime_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ChatbotRealtime_arrayLikeToArray(e,t):void 0}}function ChatbotRealtime_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ChatbotRealtime_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function ChatbotRealtime_arrayWithHoles(e){if(Array.isArray(e))return e}var DEBUG_LEVELS={none:0,low:1,normal:2,high:3,verbose:4},CURRENT_DEBUG=DEBUG_LEVELS.low;function debugLog(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];CURRENT_DEBUG>=e&&(t=console).log.apply(t,n)}function parseUsage(e){if(!e)return null;var t=e.input_token_details,r=void 0===t?{}:t,n=r.text_tokens,a=void 0===n?0:n,o=r.audio_tokens,i=void 0===o?0:o,s=r.cached_tokens_details,c=void 0===s?{}:s,u=c.text_tokens,l=void 0===u?0:u,p=c.audio_tokens,d=void 0===p?0:p,f=e.output_token_details,h=void 0===f?{}:f,m=h.text_tokens,y=void 0===m?0:m,_=h.audio_tokens;return{text_input_tokens:a,audio_input_tokens:i,text_output_tokens:y,audio_output_tokens:void 0===_?0:_,text_cached_tokens:l,audio_cached_tokens:d}}function getChatbotRepresentation(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user",r=e.pluginUrl,n=e.iconUrl,a=e.userData,o=e.userName,i=e.aiName,s=e.guestName,c=e.userAvatar,u=e.aiAvatar,l=e.guestAvatar,p=e.userAvatarUrl,d=e.aiAvatarUrl,f=e.guestAvatarUrl,h=function(e,t,n,a){if(t){var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,helpers.mv)(e)?e:e&&!(0,js_helpers.Ve)(e)?t?e:"".concat(r,"/images/").concat(e):null}(n,arguments.length>4&&void 0!==arguments[4]&&arguments[4])||a;if(o)return{emoji:null,text:null,image:o,use:"image"}}return(0,js_helpers.Ve)(e)?{emoji:e,text:null,image:null,use:"emoji"}:{emoji:null,text:e,image:null,use:"text"}};return"assistant"===t?h(i,u,d,n):a?h(ChatbotRealtime_formatName(o,s,a),c,p,null==a?void 0:a.AVATAR_URL,!0):a||"user"!==t?{emoji:null,text:"Unknown",image:null,use:"text"}:h(s||"Guest",l,f,null)}function ChatbotRealtime_formatName(e,t,r){return r&&0!==Object.keys(r).length?Object.entries(r).reduce((function(e,t){var r=ChatbotRealtime_slicedToArray(t,2),n=r[0],a=r[1],o="{".concat(n,"}");return e.includes(o)?e.replace(o,a):e}),e):t||e||"Guest"}var ChatbotRealtime=function(){var e=(0,ChatbotContext.o)(),t=e.state,r=e.actions,n=t.busy,a=t.locked,o=t.open,i=t.popup,s=r.onStartRealtimeSession,c=r.onRealtimeFunctionCallback,u=r.onCommitStats,l=r.onCommitDiscussions,p=ChatbotRealtime_slicedToArray((0,external_React_.useState)(!1),2),d=p[0],f=p[1],h=ChatbotRealtime_slicedToArray((0,external_React_.useState)(!1),2),m=h[0],y=h[1],_=ChatbotRealtime_slicedToArray((0,external_React_.useState)(!1),2),b=_[0],v=_[1],g=ChatbotRealtime_slicedToArray((0,external_React_.useState)(null),2),w=(g[0],g[1]),x=ChatbotRealtime_slicedToArray((0,external_React_.useState)(null),2),C=(x[0],x[1]),S=ChatbotRealtime_slicedToArray((0,external_React_.useState)({text_input_tokens:0,audio_input_tokens:0,text_output_tokens:0,audio_output_tokens:0,text_cached_tokens:0,audio_cached_tokens:0}),2),R=S[0],E=S[1],I=ChatbotRealtime_slicedToArray((0,external_React_.useState)([]),2),k=I[0],A=I[1],T=(0,external_React_.useRef)(new Set),O=(0,external_React_.useRef)(null),P=(0,external_React_.useRef)(null),L=(0,external_React_.useRef)(null),j=ChatbotRealtime_slicedToArray((0,external_React_.useState)(!0),2),U=j[0],D=(j[1],ChatbotRealtime_slicedToArray((0,external_React_.useState)(!0),2)),M=D[0],N=D[1],B=ChatbotRealtime_slicedToArray((0,external_React_.useState)(!1),2),F=B[0],z=B[1],W=ChatbotRealtime_slicedToArray((0,external_React_.useState)(!1),2),$=W[0],H=W[1],G=ChatbotRealtime_slicedToArray((0,external_React_.useState)(null),2),K=G[0],V=G[1],q=(0,external_React_.useRef)([]),J=(0,external_React_.useMemo)((function(){return getChatbotRepresentation(t,"user")}),[t]),Q=(0,external_React_.useMemo)((function(){return getChatbotRepresentation(t,"assistant")}),[t]);(0,external_React_.useEffect)((function(){!o&&m&&i&&te()}),[o,i,m]);var X=(0,external_React_.useCallback)(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[u]),Y=(0,external_React_.useCallback)((function(){P.current&&"open"===P.current.readyState?(P.current.send(JSON.stringify({type:"session.update",session:{input_audio_transcription:{model:"whisper-1"}}})),debugLog(DEBUG_LEVELS.low,"Sent session.update to enable Whisper.")):console.error("Data channel is not open yet; cannot enable transcription.")}),[]),Z=(0,external_React_.useCallback)(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r,n){var a,o,i,s,u,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={};try{a=JSON.parse(n||"{}")}catch(e){console.error("Could not parse function arguments.",n)}if(o=q.current,i=o.find((function(e){return e.name===r})),i){e.next=7;break}return console.error("No match for callback: '".concat(r,"'.")),e.abrupt("return");case 7:return e.prev=7,e.next=10,c(i.id,i.type,i.name,i.target,a);case 10:if(null!=(u=e.sent)&&u.success){e.next=14;break}return console.error("Callback failed.",null==u?void 0:u.message),e.abrupt("return");case 14:l=u.data,"open"===(null===(s=P.current)||void 0===s?void 0:s.readyState)&&(debugLog(DEBUG_LEVELS.low,"Send callback value:",l),P.current.send(JSON.stringify({type:"conversation.item.create",item:{type:"function_call_output",call_id:t,output:JSON.stringify(l)}})),P.current.send(JSON.stringify({type:"response.create",response:{instructions:"Reply based on the function's output."}}))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),console.error("Error in handleFunctionCall.",e.t0);case 21:case"end":return e.stop()}}),e,null,[[7,18]])})));return function(t,r,n){return e.apply(this,arguments)}}(),[c]),ee=(0,external_React_.useCallback)(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,r){var n,a,o,i,s,c,u;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),n=new RTCPeerConnection,O.current=n,e.prev=3,e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:a=e.sent,L.current=a,a.getTracks().forEach((function(e){return n.addTrack(e,a)})),e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(3),console.error("Error accessing microphone.",e.t0),f(!1),e.abrupt("return");case 16:return n.ontrack=function(e){var t=document.getElementById("mwai-audio");t&&(t.srcObject=e.streams[0]),V(e.streams[0])},o=n.createDataChannel("oai-events"),P.current=o,o.addEventListener("open",(function(){debugLog(DEBUG_LEVELS.low,"Data channel open."),Y()})),o.addEventListener("message",(function(e){var t;try{t=JSON.parse(e.data)}catch(t){return void console.error("Could not parse Realtime message.",e.data)}if(CURRENT_DEBUG>=DEBUG_LEVELS.high)console.log("Incoming message from Realtime API.",t);else if(CURRENT_DEBUG===DEBUG_LEVELS.low){var r;((null===(r=t.type)||void 0===r?void 0:r.endsWith(".done"))||"input_audio_buffer.committed"===t.type||"conversation.item.input_audio_transcription.completed"===t.type||"response.done"===t.type)&&console.log("Key event from Realtime API.",t)}switch(t.type){case"input_audio_buffer.committed":var n=t.item_id;T.current.has(n)||(T.current.add(n),A((function(e){return[].concat(_toConsumableArray(e),[{id:n,role:"user",content:"[Audio]"}])}))),C("user");break;case"conversation.item.input_audio_transcription.completed":var a=t.item_id,o=(t.transcript||"[Audio]").trim();A((function(e){return e.map((function(e){return e.id===a&&"user"===e.role?ChatbotRealtime_objectSpread(ChatbotRealtime_objectSpread({},e),{},{content:o}):e}))}));break;case"response.audio_transcript.done":var i=t.item_id,s=(t.transcript||"[Audio]").trim();C("assistant"),T.current.has(i)||(T.current.add(i),A((function(e){return[].concat(_toConsumableArray(e),[{id:i,role:"assistant",content:s}])})));break;case"response.function_call_arguments.done":var c=t,u=c.call_id,l=c.name,p=c.arguments;debugLog(DEBUG_LEVELS.low,"Function call requested.",u,l),Z(u,l,p);break;case"response.done":var d=t.response;if(null!=d&&d.usage){var f=parseUsage(d.usage);f&&E((function(e){var t={text_input_tokens:(e.text_input_tokens||0)+f.text_input_tokens,audio_input_tokens:(e.audio_input_tokens||0)+f.audio_input_tokens,text_output_tokens:(e.text_output_tokens||0)+f.text_output_tokens,audio_output_tokens:(e.audio_output_tokens||0)+f.audio_output_tokens,text_cached_tokens:(e.text_cached_tokens||0)+f.text_cached_tokens,audio_cached_tokens:(e.audio_cached_tokens||0)+f.audio_cached_tokens};return X(t),t}))}C("user")}})),e.next=23,n.createOffer();case 23:return i=e.sent,e.next=26,n.setLocalDescription(i);case 26:return s=r||"gpt-4o-preview-2024-12-17",e.next=30,fetch("".concat("https://api.openai.com/v1/realtime","?model=").concat(s),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/sdp"},body:i.sdp});case 30:if((c=e.sent).ok){e.next=35;break}return console.error("SDP exchange failed.",c),f(!1),e.abrupt("return");case 35:return e.next=37,c.text();case 37:return u=e.sent,e.next=40,n.setRemoteDescription({type:"answer",sdp:u});case 40:debugLog(DEBUG_LEVELS.low,"Realtime connection established."),f(!1),y(!0),v(!1),C("user");case 45:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t,r){return e.apply(this,arguments)}}(),[Y,Z,X]),te=(0,external_React_.useCallback)((function(){try{O.current&&(O.current.close(),O.current=null),L.current&&(L.current.getTracks().forEach((function(e){return e.stop()})),L.current=null),P.current=null,f(!1),y(!1),v(!1),C(null),console.log("Messages:",k),console.log("Statistics:",R),l(k),A([]),E({text_input_tokens:0,audio_input_tokens:0,text_output_tokens:0,audio_output_tokens:0,text_cached_tokens:0,audio_cached_tokens:0}),debugLog(DEBUG_LEVELS.low,"Stopped Realtime connection.")}catch(e){console.error("Error stopping connection.",e)}}),[k,R,l]),re=(0,external_React_.useCallback)((function(){if(L.current){var e=L.current.getAudioTracks();e.length&&(b?(e.forEach((function(e){e.enabled=!0})),debugLog(DEBUG_LEVELS.low,"Resumed microphone."),v(!1)):(e.forEach((function(e){e.enabled=!1})),debugLog(DEBUG_LEVELS.low,"Paused microphone."),v(!0)))}}),[b]),ne=(0,external_React_.useCallback)(_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.prev=1,e.next=4,s();case 4:if(null!=(t=e.sent)&&t.success){e.next=9;break}return console.error("Could not start realtime session.",t),f(!1),e.abrupt("return");case 9:return q.current=t.function_callbacks||[],w(t.session_id),e.next=13,ee(t.client_secret,t.model);case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("Error in handlePlay.",e.t0),f(!1);case 19:case"end":return e.stop()}}),e,null,[[1,15]])}))),[s,ee]),ae=(0,external_React_.useCallback)((function(){return te()}),[te]),oe=(0,external_React_.useCallback)((function(){return N((function(e){return!e}))}),[]),ie=(0,external_React_.useCallback)((function(){return H((function(e){return!e}))}),[]),se=(0,external_React_.useCallback)((function(){return z((function(e){return!e}))}),[]),ce=(0,external_React_.useMemo)((function(){return b?"mwai-pause mwai-active":"mwai-pause"}),[b]),ue=(0,external_React_.useMemo)((function(){var e=_toConsumableArray(k).reverse().find((function(e){return"assistant"===e.role}));return e?e.content.length>256?"".concat(e.content.slice(0,256),"..."):e.content:"..."}),[k]),le=(0,external_React_.useMemo)((function(){return M?"mwai-option mwai-option-users mwai-active":"mwai-option mwai-option-users"}),[M]),pe=(0,external_React_.useMemo)((function(){return F?"mwai-option mwai-option-captions mwai-active":"mwai-option mwai-option-captions"}),[F]),de=(0,external_React_.useMemo)((function(){return $?"mwai-option mwai-option-statistics mwai-active":"mwai-option mwai-option-statistics"}),[$]);return React.createElement("div",null,React.createElement("audio",{id:"mwai-audio",autoPlay:!0}),M&&React.createElement("div",{style:{display:"flex",justifyContent:"center"}},React.createElement(AudioVisualizerTwoStreams,{assistantStream:K,userUI:J,assistantUI:Q,userStream:L.current})),React.createElement("div",{className:"mwai-controls"},!m&&!d&&React.createElement("button",{onClick:ne,className:"mwai-play",disabled:n||a,"aria-label":"Play"},React.createElement(Play,{size:16})),d&&React.createElement("button",{className:"mwai-play",disabled:!0},React.createElement(Loader,{size:16,style:{animation:"spin 0.8s linear infinite"}})),m&&!d&&React.createElement(React.Fragment,null,React.createElement("button",{onClick:ae,className:"mwai-stop",disabled:n||a,"aria-label":"Stop"},React.createElement(Square,{size:16})),React.createElement("button",{onClick:re,className:ce,disabled:n||a,"aria-label":"Pause"},React.createElement(Pause,{size:16})))),F&&ue&&ue.length>0&&React.createElement("div",{className:"mwai-last-transcript"},ue),$&&React.createElement("div",{className:"mwai-statistics"},React.createElement("div",null,React.createElement("label",null,"Text In"),React.createElement("span",null,R.text_input_tokens)),React.createElement("div",null,React.createElement("label",null,"Text Out"),React.createElement("span",null,R.text_output_tokens)),React.createElement("div",null,React.createElement("label",null,"Text Cached"),React.createElement("span",null,R.text_cached_tokens)),React.createElement("div",null,React.createElement("label",null,"Audio In"),React.createElement("span",null,R.audio_input_tokens)),React.createElement("div",null,React.createElement("label",null,"Audio Out"),React.createElement("span",null,R.audio_output_tokens)),React.createElement("div",null,React.createElement("label",null,"Audio Cached"),React.createElement("span",null,R.audio_cached_tokens))),U&&React.createElement("div",{className:"mwai-options"},React.createElement(Users,{size:13,title:"Show Users",className:le,onClick:oe}),React.createElement(Captions,{size:18,title:"Show Captions",className:pe,onClick:se}),React.createElement(Bug,{size:14,title:"Show Statistics",className:de,onClick:ie})))};const chatbot_ChatbotRealtime=ChatbotRealtime;function ChatbotUI_typeof(e){return ChatbotUI_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ChatbotUI_typeof(e)}function ChatbotUI_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ChatbotUI_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ChatbotUI_ownKeys(Object(r),!0).forEach((function(t){ChatbotUI_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ChatbotUI_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ChatbotUI_defineProperty(e,t,r){return(t=ChatbotUI_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ChatbotUI_toPropertyKey(e){var t=ChatbotUI_toPrimitive(e,"string");return"symbol"==ChatbotUI_typeof(t)?t:String(t)}function ChatbotUI_toPrimitive(e,t){if("object"!=ChatbotUI_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ChatbotUI_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function ChatbotUI_slicedToArray(e,t){return ChatbotUI_arrayWithHoles(e)||ChatbotUI_iterableToArrayLimit(e,t)||ChatbotUI_unsupportedIterableToArray(e,t)||ChatbotUI_nonIterableRest()}function ChatbotUI_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ChatbotUI_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return ChatbotUI_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ChatbotUI_arrayLikeToArray(e,t):void 0}}function ChatbotUI_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ChatbotUI_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function ChatbotUI_arrayWithHoles(e){if(Array.isArray(e))return e}var ChatbotUI_wp$element=wp.element,ChatbotUI_useState=ChatbotUI_wp$element.useState,ChatbotUI_useMemo=ChatbotUI_wp$element.useMemo,useLayoutEffect=ChatbotUI_wp$element.useLayoutEffect,ChatbotUI_useCallback=ChatbotUI_wp$element.useCallback,ChatbotUI_useEffect=ChatbotUI_wp$element.useEffect,ChatbotUI_useRef=ChatbotUI_wp$element.useRef,markdownOptions={overrides:{a:{props:{target:"_blank"}}}},isImage=function(e){return e.type.startsWith("image/")},isDocument=function(e){return["text/x-c","text/x-csharp","text/x-c++","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/html","text/x-java","application/json","text/markdown","application/pdf","text/x-php","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/x-python","text/x-script.python","text/x-ruby","text/x-tex","text/plain","text/css","text/javascript","application/x-sh","application/typescript"].includes(e.type)},ChatbotUI=function(e){var t=(0,helpers.gR)(),r=e.style,n=ChatbotUI_slicedToArray(ChatbotUI_useState(!0),2),a=n[0],o=n[1],i=(0,ChatbotContext.o)(),s=i.state,c=i.actions,u=s.theme,l=s.botId,p=s.customId,d=s.messages,f=s.textCompliance,h=s.isWindow,m=s.fullscreen,y=s.iconPosition,_=s.iconBubble,b=s.shortcuts,v=s.blocks,g=s.imageUpload,w=s.fileSearch,x=s.fileUpload,C=s.draggingType,S=s.isBlocked,R=s.virtualKeyboardFix,E=s.isRealtime,I=s.windowed,k=s.cssVariables,A=s.error,T=s.conversationRef,O=s.open,P=s.busy,L=s.uploadIconPosition,j=s.chatbotInputRef,U=c.resetError,D=c.onSubmit,M=c.setIsBlocked,N=c.setDraggingType,B=c.onUploadFile,F=ChatbotUI_useMemo((function(){return"css"===(null==u?void 0:u.type)?null==u?void 0:u.style:null}),[u]),z=g||w||x,W=z||f,$=ChatbotUI_useRef(null),H=(0,helpers.kW)(),G=H.viewportHeight,K=H.isIOS,V=H.isAndroid;ChatbotUI_useEffect((function(){if(R&&(K||V)&&h){var e=document.querySelector(".mwai-window");e&&(O?(e.style.height="".concat(G,"px"),K&&function(){if("INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName){window.scrollTo({top:0});var e=setInterval((function(){window.scrollTo({top:0})}),100);setTimeout((function(){clearInterval(e)}),1e3)}}()):e.style.height="")}}),[m,V,K,h,I,O,G,R]);var q=t("mwai-chatbot",ChatbotUI_defineProperty(ChatbotUI_defineProperty(ChatbotUI_defineProperty(ChatbotUI_defineProperty(ChatbotUI_defineProperty(ChatbotUI_defineProperty(ChatbotUI_defineProperty(ChatbotUI_defineProperty({},"mwai-".concat(null==u?void 0:u.themeId,"-theme"),!0),"mwai-window",h),"mwai-bubble",_),"mwai-open",O),"mwai-fullscreen",!I||!h&&m),"mwai-bottom-left","bottom-left"===y),"mwai-top-right","top-right"===y),"mwai-top-left","top-left"===y));useLayoutEffect((function(){a&&T.current&&(T.current.scrollTop=T.current.scrollHeight)}),[d,a,T,P]);var J=ChatbotUI_useRef(new Set);ChatbotUI_useEffect((function(){v&&v.length>0&&v.forEach((function(e){var t=e.type,r=e.data;"content"===t&&r.script&&function(e){var t=function(e){var t,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r}(e);if(!J.current.has(t)){var r=document.createElement("script");r.type="text/javascript",r.textContent=e,document.body.appendChild(r),J.current.add(t)}}(r.script)}))}),[v]);var Q=ChatbotUI_useMemo((function(){return null==d?void 0:d.map((function(e){return React.createElement(chatbot_ChatbotReply,{key:e.id,message:e})}))}),[d]),X=ChatbotUI_useMemo((function(){return b&&0!==b.length?React.createElement("div",{className:"mwai-shortcuts"},b.map((function(e,r){var n=e.type,a=e.data,o=null!=a?a:{},i=o.label,s=o.variant,c=o.icon,u=o.className,p=t("mwai-shortcut",{"mwai-success":"success"===s,"mwai-danger":"danger"===s,"mwai-warning":"warning"===s,"mwai-info":"info"===s});u&&(p+=" ".concat(u));var d=c&&c.startsWith("http"),f=c&&!d&&c.length>=1&&c.length<=2;switch(n){case"message":var h=a.message;return React.createElement("button",{className:p,key:r,onClick:function(){D(h)}},(d||f)&&React.createElement(React.Fragment,null,React.createElement("div",{className:"mwai-icon"},d&&React.createElement("img",{src:c,alt:i||"AI Shortcut"}),f&&React.createElement("span",{role:"img","aria-label":"AI Shortcut"},c)),React.createElement("div",{style:{flex:"auto"}})),React.createElement("div",{className:"mwai-label"},i||"N/A"));case"callback":var m=a.onClick;return React.createElement("button",{className:p,key:r,onClick:function(){if("function"==typeof m)m();else if("string"==typeof m){var e=m.replace(/{CHATBOT_ID}/g,l),t=new Function("return (".concat(e,");"))();a.onClick=t,t()}else console.warn("No valid callback function provided in data.onClick.")}},(d||f)&&React.createElement(React.Fragment,null,React.createElement("div",{className:"mwai-icon"},d&&React.createElement("img",{src:c,alt:i||"AI Shortcut"}),f&&React.createElement("span",{role:"img","aria-label":"AI Shortcut"},c)),React.createElement("div",{style:{flex:"auto"}})),React.createElement("div",{className:"mwai-label"},i||"N/A"));default:return console.warn("This shortcut type is not supported: ".concat(n,".")),null}}))):null}),[t,D,b]),Y=ChatbotUI_useMemo((function(){return v&&0!==v.length?React.createElement("div",{className:"mwai-blocks"},v.map((function(e,r){var n=e.type,a=e.data;if("content"!==n)return console.warn("Block type ".concat(n," is not supported.")),null;var o=a.html,i=a.variant,s=t("mwai-block",{"mwai-success":"success"===i,"mwai-danger":"danger"===i,"mwai-warning":"warning"===i,"mwai-info":"info"===i});return React.createElement("div",{className:s,key:r,dangerouslySetInnerHTML:{__html:o}})}))):null}),[t,v]),Z=ChatbotUI_useCallback((function(e,t){e.preventDefault(),e.stopPropagation();var r=e.dataTransfer.items[0];t?($.current&&(clearTimeout($.current),$.current=null),g&&isImage(r)?(N("image"),M(!1)):(w||x)&&isDocument(r)?(N("document"),M(!1)):(N(!1),M(!0))):$.current||($.current=setTimeout((function(){N(!1),M(!1),$.current=null}),100))}),[g,w,x]),ee=ChatbotUI_useCallback((function(e){if(e.preventDefault(),Z(e,!1),!P){var t=e.dataTransfer.files[0];t&&("image"===C&&g||"document"===C&&(w||x)?B(t):(M(!0),setTimeout((function(){return M(!1)}),2e3)))}}),[P,C,g,x,w,B]),te=t("mwai-input",{"mwai-dragging":C,"mwai-blocked":S});return React.createElement(helpers.bE,{dir:"auto",id:"mwai-chatbot-".concat(p||l),className:q,style:ChatbotUI_objectSpread(ChatbotUI_objectSpread({},k),r),if:!0,disableTransition:!h},F&&React.createElement("style",null,F),React.createElement(chatbot_ChatbotTrigger,null),React.createElement(chatbot_ChatbotHeader,null),React.createElement("div",{className:"mwai-content"},!E&&React.createElement(React.Fragment,null,React.createElement("div",{ref:T,className:"mwai-conversation",onScroll:function(){if(T.current){var e=T.current,t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;o(r-t<=n+1)}}},Q,X),A&&React.createElement("div",{className:"mwai-error",onClick:function(){return U()}},React.createElement(index_modern,{options:markdownOptions},A)),Y,React.createElement("div",{className:te,onClick:function(){var e;return null===(e=j.current)||void 0===e?void 0:e.focusInput()},onDrop:ee,onDragEnter:function(e){return Z(e,!0)},onDragLeave:function(e){return Z(e,!1)},onDragOver:function(e){return Z(e,!0)}},React.createElement(chatbot_ChatbotInput,null),React.createElement(chatbot_ChatbotSubmit,null))),E&&React.createElement("div",{className:"mwai-realtime"},React.createElement(chatbot_ChatbotRealtime,null)),W&&React.createElement("div",{className:"mwai-footer"},z&&React.createElement("div",{className:"mwai-tools"},"mwai-tools"===L&&React.createElement(chatbot_ChatUploadIcon,null)),f&&React.createElement("div",{className:"mwai-compliance",dangerouslySetInnerHTML:{__html:f}}))))};const chatbot_ChatbotUI=ChatbotUI;var ChatbotSystem=function(e){return React.createElement(ChatbotContext.G,e,React.createElement(chatbot_ChatbotUI,e))};const chatbot_ChatbotSystem=ChatbotSystem;var src_helpers=__webpack_require__(296);function DiscussionsContext_typeof(e){return DiscussionsContext_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},DiscussionsContext_typeof(e)}var DiscussionsContext_excluded=["children"];function DiscussionsContext_toConsumableArray(e){return DiscussionsContext_arrayWithoutHoles(e)||DiscussionsContext_iterableToArray(e)||DiscussionsContext_unsupportedIterableToArray(e)||DiscussionsContext_nonIterableSpread()}function DiscussionsContext_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function DiscussionsContext_iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function DiscussionsContext_arrayWithoutHoles(e){if(Array.isArray(e))return DiscussionsContext_arrayLikeToArray(e)}function DiscussionsContext_regeneratorRuntime(){DiscussionsContext_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof _?t:_,i=Object.create(o.prototype),s=new T(n||[]);return a(i,"_invoke",{value:E(e,r,s)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",h="executing",m="completed",y={};function _(){}function b(){}function v(){}var g={};u(g,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(O([])));x&&x!==r&&n.call(x,i)&&(g=x);var C=v.prototype=_.prototype=Object.create(g);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(a,o,i,s){var c=p(e[a],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==DiscussionsContext_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,s)}))}s(c.arg)}var o;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function E(t,r,n){var a=d;return function(o,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===o)throw i;return{value:e,done:!0}}for(n.method=o,n.arg=i;;){var s=n.delegate;if(s){var c=I(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=h;var u=p(t,r,n);if("normal"===u.type){if(a=n.done?m:f,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(a=m,n.method="throw",n.arg=u.arg)}}}function I(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,I(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var o=p(a,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,y;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}throw new TypeError(DiscussionsContext_typeof(t)+" is not iterable")}return b.prototype=v,a(C,"constructor",{value:v,configurable:!0}),a(v,"constructor",{value:b,configurable:!0}),b.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},S(R.prototype),u(R.prototype,s,(function(){return this})),t.AsyncIterator=R,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new R(l(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(C),u(C,c,"Generator"),u(C,i,(function(){return this})),u(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=O,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return s.type="throw",s.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;A(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:O(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function DiscussionsContext_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function DiscussionsContext_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?DiscussionsContext_ownKeys(Object(r),!0).forEach((function(t){DiscussionsContext_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DiscussionsContext_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function DiscussionsContext_defineProperty(e,t,r){return(t=DiscussionsContext_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DiscussionsContext_toPropertyKey(e){var t=DiscussionsContext_toPrimitive(e,"string");return"symbol"==DiscussionsContext_typeof(t)?t:String(t)}function DiscussionsContext_toPrimitive(e,t){if("object"!=DiscussionsContext_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=DiscussionsContext_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function DiscussionsContext_asyncGeneratorStep(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function DiscussionsContext_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){DiscussionsContext_asyncGeneratorStep(o,n,a,i,s,"next",e)}function s(e){DiscussionsContext_asyncGeneratorStep(o,n,a,i,s,"throw",e)}i(void 0)}))}}function DiscussionsContext_slicedToArray(e,t){return DiscussionsContext_arrayWithHoles(e)||DiscussionsContext_iterableToArrayLimit(e,t)||DiscussionsContext_unsupportedIterableToArray(e,t)||DiscussionsContext_nonIterableRest()}function DiscussionsContext_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function DiscussionsContext_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return DiscussionsContext_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?DiscussionsContext_arrayLikeToArray(e,t):void 0}}function DiscussionsContext_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function DiscussionsContext_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function DiscussionsContext_arrayWithHoles(e){if(Array.isArray(e))return e}function DiscussionsContext_objectWithoutProperties(e,t){if(null==e)return{};var r,n,a=DiscussionsContext_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function DiscussionsContext_objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}var DiscussionsContext=(0,external_React_.createContext)(),useDiscussionsContext=function(){var e=(0,external_React_.useContext)(DiscussionsContext);if(!e)throw new Error("useDiscussionsContext must be used within a DiscussionsContextProvider");return e},DiscussionsContextProvider=function(e){var t=e.children,r=DiscussionsContext_objectWithoutProperties(e,DiscussionsContext_excluded),n=r.system,a=r.theme,o=DiscussionsContext_slicedToArray((0,external_React_.useState)([]),2),i=o[0],s=o[1],c=DiscussionsContext_slicedToArray((0,external_React_.useState)(null),2),u=c[0],l=c[1],p=DiscussionsContext_slicedToArray((0,external_React_.useState)(!1),2),d=p[0],f=p[1],h=(0,external_React_.useMemo)((function(){return(null==a?void 0:a.settings)||{}}),[a]),m=n.botId,y=n.customId,_=n.restNonce,b=n.pluginUrl,v=n.restUrl,g=n.debugMode,w=(0,external_React_.useMemo)((function(){return Object.keys(h).reduce((function(e,t){return e["--mwai-".concat(t)]=h[t],e}),{})}),[h]),x=(0,external_React_.useMemo)((function(){return i.some((function(e){return 0===e.messages.length}))}),[i]),C=(0,external_React_.useCallback)(DiscussionsContext_asyncToGenerator(DiscussionsContext_regeneratorRuntime().mark((function e(){var t,r,n,a,o,i=arguments;return DiscussionsContext_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],e.prev=1,t||f(!0),r={botId:m||y},g&&console.log("[DISCUSSIONS] OUT: ",r),e.next=7,fetch("".concat(v,"/mwai-ui/v1/discussions/list"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":_},body:(0,src_helpers.F1)(r)});case 7:return n=e.sent,e.next=10,n.json();case 10:if((a=e.sent).success){e.next=13;break}throw new Error("Could not retrieve the discussions: ".concat(a.message));case 13:g&&console.log("[DISCUSSIONS] IN: ",a),o=a.chats.map((function(e){var t=JSON.parse(e.messages),r=JSON.parse(e.extra);return DiscussionsContext_objectSpread(DiscussionsContext_objectSpread({},e),{},{messages:t,extra:r})})),s((function(e){var t=new Map;e.forEach((function(e){t.set(e.chatId,e)})),o.forEach((function(e){t.set(e.chatId,e)}));var r=Array.from(t.values());if(u){var n=r.find((function(e){return e.chatId===u.chatId}));n&&n!==u&&l(n)}return r})),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),console.error(e.t0);case 21:return e.prev=21,t||f(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[1,18,21,24]])}))),[u]);(0,external_React_.useEffect)((function(){C();var e=setInterval((function(){C(!0)}),5e3);return function(){return clearInterval(e)}}),[]),(0,external_React_.useEffect)((function(){if(u){var e=i.find((function(e){return e.chatId===u.chatId}));e&&e!==u&&l(e)}}),[i]);var S=function(e){var t=MwaiAPI.getChatbot(e);if(!t)throw new Error("Chatbot not found.",{botId:e,chatbots:MwaiAPI.chatbots});return t},R=function(){var e=DiscussionsContext_asyncToGenerator(DiscussionsContext_regeneratorRuntime().mark((function e(t){var r;return DiscussionsContext_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.find((function(e){return e.chatId===t}))){e.next=4;break}return console.error("Discussion not found.",{chatId:t,discussions:i}),e.abrupt("return");case 4:s((function(e){return e.filter((function(e){return e.messages.length>0||e.chatId===t}))})),S(m).setContext({chatId:t,messages:r.messages}),l(r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=DiscussionsContext_asyncToGenerator(DiscussionsContext_regeneratorRuntime().mark((function e(t){var r,n,a,o,i;return DiscussionsContext_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=prompt("Enter a new title for the discussion:",t.title||""))){e.next=3;break}return e.abrupt("return");case 3:if(""!==(n=r.trim())){e.next=7;break}return alert("Title cannot be empty."),e.abrupt("return");case 7:return e.prev=7,f(!0),a={chatId:t.chatId,title:n},e.next=12,fetch("".concat(v,"/mwai-ui/v1/discussions/edit"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":_},body:(0,src_helpers.F1)(a)});case 12:return o=e.sent,e.next=15,o.json();case 15:if((i=e.sent).success){e.next=18;break}throw new Error("Could not update the discussion: ".concat(i.message));case 18:s((function(e){return e.map((function(e){return e.chatId===t.chatId?DiscussionsContext_objectSpread(DiscussionsContext_objectSpread({},e),{},{title:n}):e}))})),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(7),console.error(e.t0),alert("An error occurred while updating the discussion.");case 25:return e.prev=25,f(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[7,21,25,28]])})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=DiscussionsContext_asyncToGenerator(DiscussionsContext_regeneratorRuntime().mark((function e(t){var r,n,a;return DiscussionsContext_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("Are you sure you want to delete this discussion?")){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,f(!0),r={chatIds:[t.chatId]},e.next=8,fetch("".concat(v,"/mwai-ui/v1/discussions/delete"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":_},body:(0,src_helpers.F1)(r)});case 8:return n=e.sent,e.next=11,n.json();case 11:if((a=e.sent).success){e.next=14;break}throw new Error("Could not delete the discussion: ".concat(a.message));case 14:s((function(e){return e.filter((function(e){return e.chatId!==t.chatId}))})),(null==u?void 0:u.chatId)===t.chatId&&l(null),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),console.error(e.t0),alert("An error occurred while deleting the discussion.");case 22:return e.prev=22,f(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[3,18,22,25]])})));return function(t){return e.apply(this,arguments)}}(),k=function(){var e=DiscussionsContext_asyncToGenerator(DiscussionsContext_regeneratorRuntime().mark((function e(){var t,r,n,a;return DiscussionsContext_regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=i.find((function(e){return 0===e.messages.length})))){e.next=4;break}return l(t),e.abrupt("return");case 4:r=S(m),n=(0,js_helpers.vx)(),r.clear({chatId:n}),l(a={id:n,chatId:n,messages:[],title:"New Chat",extra:{}}),s((function(e){return[a].concat(DiscussionsContext_toConsumableArray(e))}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A={onDiscussionClick:R,onNewChatClick:k,onEditDiscussion:E,onDeleteDiscussion:I},T={botId:m,pluginUrl:b,busy:d,setBusy:f,cssVariables:w,discussions:i,discussion:u,theme:a,hasEmptyDiscussion:x};return React.createElement(DiscussionsContext.Provider,{value:{state:T,actions:A}},t)};const Pencil=(0,createLucideIcon.A)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Trash=(0,createLucideIcon.A)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);function DiscussionsUI_typeof(e){return DiscussionsUI_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},DiscussionsUI_typeof(e)}function DiscussionsUI_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function DiscussionsUI_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?DiscussionsUI_ownKeys(Object(r),!0).forEach((function(t){DiscussionsUI_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DiscussionsUI_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function DiscussionsUI_defineProperty(e,t,r){return(t=DiscussionsUI_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DiscussionsUI_toPropertyKey(e){var t=DiscussionsUI_toPrimitive(e,"string");return"symbol"==DiscussionsUI_typeof(t)?t:String(t)}function DiscussionsUI_toPrimitive(e,t){if("object"!=DiscussionsUI_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=DiscussionsUI_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function DiscussionsUI_slicedToArray(e,t){return DiscussionsUI_arrayWithHoles(e)||DiscussionsUI_iterableToArrayLimit(e,t)||DiscussionsUI_unsupportedIterableToArray(e,t)||DiscussionsUI_nonIterableRest()}function DiscussionsUI_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function DiscussionsUI_unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return DiscussionsUI_arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?DiscussionsUI_arrayLikeToArray(e,t):void 0}}function DiscussionsUI_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function DiscussionsUI_iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function DiscussionsUI_arrayWithHoles(e){if(Array.isArray(e))return e}var Discussion=function(e){var t=e.discussion,r=e.onClick,n=void 0===r?function(){}:r,a=e.selected,o=void 0!==a&&a,i=e.onEdit,s=void 0===i?function(){}:i,c=e.onDelete,u=void 0===c?function(){}:c,l=(0,helpers.gR)(),p=DiscussionsUI_slicedToArray((0,external_React_.useState)(!1),2),d=p[0],f=p[1],h=t.messages,m=h[h.length-1],y=(0,external_React_.useMemo)((function(){return t.title?t.title:((null==m?void 0:m.content.length)>64?m.content.substring(0,64)+"...":m.content)||"No messages yet"}),[t,m]),_=l("mwai-discussion",{"mwai-active":o}),b=(0,external_React_.useCallback)((function(e){e.stopPropagation(),u(t)}),[t,u]),v=(0,external_React_.useCallback)((function(e){e.stopPropagation(),s(t)}),[t,s]);return React.createElement("li",{className:_,onClick:n,onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)}},React.createElement("span",{className:l("mwai-discussion-title")},y),d&&React.createElement("div",{className:l("mwai-discussion-actions")},React.createElement("div",{className:l("mwai-icon"),onClick:v},React.createElement(Pencil,{size:18})),React.createElement("div",{className:l(["mwai-icon","mwai-danger"]),onClick:b},React.createElement(Trash,{size:18}))))},DiscussionsUI=function(e){var t=e.theme,r=e.style,n=e.params,a=(0,helpers.gR)(),o=(0,external_React_.useMemo)((function(){return"css"===(null==t?void 0:t.type)?null==t?void 0:t.style:null}),[t]),i=useDiscussionsContext(),s=i.state,c=i.actions,u=s.botId,l=s.cssVariables,p=s.discussions,d=s.discussion,f=s.busy,h=s.hasEmptyDiscussion,m=c.onDiscussionClick,y=c.onNewChatClick,_=c.onEditDiscussion,b=c.onDeleteDiscussion,v=n.textNewChat;(0,external_React_.useEffect)((function(){}));var g=a("mwai-discussions",DiscussionsUI_defineProperty({},"mwai-".concat(null==t?void 0:t.themeId,"-theme"),!0));return React.createElement(React.Fragment,null,React.createElement("div",{id:"mwai-discussions-".concat(u),className:g,style:DiscussionsUI_objectSpread(DiscussionsUI_objectSpread({},l),r)},o&&React.createElement("style",null,o),React.createElement("div",{className:a("mwai-header")},React.createElement("button",{onClick:function(){return y()},disabled:f||h},React.createElement("span",null,null!=v?v:"+ New chat"))),React.createElement("ul",{className:a("mwai-content")},p.map((function(e){return React.createElement(Discussion,{key:e.id,discussion:e,selected:(null==d?void 0:d.id)===e.id,onClick:function(){return m(e.chatId)},onEdit:_,onDelete:b})})))))};const chatbot_DiscussionsUI=DiscussionsUI;var DiscussionsSystem=function(e){return React.createElement(DiscussionsContextProvider,e,React.createElement(chatbot_DiscussionsUI,e))};const chatbot_DiscussionsSystem=DiscussionsSystem;var render=wp.element.render;function decodeHtmlEntities(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}document.addEventListener("DOMContentLoaded",(function(){function e(e,t){e.forEach((function(e){var r=JSON.parse(decodeHtmlEntities(e.getAttribute("data-params"))),n=JSON.parse(decodeHtmlEntities(e.getAttribute("data-system"))),a=JSON.parse(decodeHtmlEntities(e.getAttribute("data-theme")));e.removeAttribute("data-params"),e.removeAttribute("data-system"),e.removeAttribute("data-theme"),render(t({system:n,params:r,theme:a}),e)}))}e(document.querySelectorAll(".mwai-chatbot-container"),chatbot_ChatbotSystem),e(document.querySelectorAll(".mwai-discussions-container"),chatbot_DiscussionsSystem)}))})();